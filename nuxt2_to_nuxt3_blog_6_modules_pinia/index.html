<!DOCTYPE html><html  lang="zh-Hant-TW" data-bs-theme="dark" data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>部落格Nuxt 2升級Nuxt 3（六）：Vuex → Pinia｜隨機手札</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-KHMFPTGCC2"></script>
<script>window.dataLayer = window.dataLayer || []
          function gtag() {
            dataLayer.push(arguments)
          }
          gtag('js', new Date())
    
          gtag('config', 'G-KHMFPTGCC2')</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap">
<link rel="stylesheet" href="/blog/_nuxt/entry.CAWthgKd.css" crossorigin>
<link rel="stylesheet" href="/blog/_nuxt/default.Y1_wz2uk.css" crossorigin>
<link rel="stylesheet" href="/blog/_nuxt/_slug_.BZ_bvq5W.css" crossorigin>
<link rel="stylesheet" href="/blog/_nuxt/articles-list-pick-container.3LBDKlOS.css" crossorigin>
<link rel="stylesheet" href="/blog/_nuxt/article-code.BjFTcNCv.css" crossorigin>
<link rel="preload" as="fetch" crossorigin="anonymous" href="/blog/nuxt2_to_nuxt3_blog_6_modules_pinia/_payload.json?6e3de1d4-c2bd-4240-a0de-3cd3ad7a51b4">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ClO9ClXx.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/Bf70C-oi.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/evB2dyb6.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/Bsathne8.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/Dsn1-m6T.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/BnTY1XpH.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/CyjxBgm-.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/DUDh0Kdr.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/DoF6DCDp.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/Y4CKq0wH.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/ClYHo0sx.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/C-v3KzvZ.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/CxYJgpPD.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/DO7FAI-K.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/B6bgwv3G.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/UwstfKco.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/BTH0UgSb.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/CfU5U-VB.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/puthNjpv.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/DTJFoaNA.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/6f3cgatz.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/DLPyKLOp.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/BQ4g43OX.js">
<link rel="modulepreload" as="script" crossorigin href="/blog/_nuxt/CZnF2WC5.js">
<link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/B9K5rw8f.js">
<link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/CDUZEaoc.js">
<link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/Cpj98o6Y.js">
<link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/CFORz_ND.js">
<link rel="prefetch" as="script" crossorigin href="/blog/_nuxt/BBJlBWJ8.js">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="format-detection" content="telephone=no">
<meta property="og:site_name" content="隨機手札">
<meta property="og:locale" content="zh_TW">
<meta name="apple-mobile-web-app-title" content="隨機手札">
<link rel="icon" href="https://huangchingchieh.github.io/blog/favicon.ico">
<link rel="apple-touch-icon" href="https://huangchingchieh.github.io/blog//pwa-192x192.png">
<link rel="mask-icon" href="https://huangchingchieh.github.io/blog//maskable-icon-512x512.png">
<link rel="manifest" href="/blog/manifest.webmanifest">
<meta name="description" content="Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供nuxtServerInit方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。">
<meta property="og:url" content="https://huangchingchieh.github.io/blog/nuxt2_to_nuxt3_blog_6_modules_pinia/">
<meta property="og:type" content="article">
<meta property="og:title" content="部落格Nuxt 2升級Nuxt 3（六）：Vuex → Pinia">
<meta property="og:description" content="Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供nuxtServerInit方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。">
<meta property="og:image" content="https://imagizer.imageshack.com/v2/1600x1200q100/924/Ia2nWi.png">
<meta property="og:article:published_time" content="2024-01-24T07:26:04.000Z">
<meta property="og:article:modified_time" content="2024-01-24T07:26:04.000Z">
<meta property="og:article:tag" content="blog">
<meta property="og:article:tag" content="nuxt">
<meta property="og:article:tag" content="vue">
<meta property="og:article:tag" content="nuxt2">
<meta property="og:article:tag" content="nuxt3">
<meta property="og:article:tag" content="vuex">
<meta property="og:article:tag" content="pinia">
<script type="application/ld+json" data-hid="a71723a">{"@context":"https://schema.org","@type":"BlogPosting","headline":"部落格Nuxt 2升級Nuxt 3（六）：Vuex → Pinia","image":["https://imagizer.imageshack.com/v2/1600x1200q100/924/Ia2nWi.png"],"datePublished":"2024-01-24T07:26:04.000Z","dateModified":"2024-01-24T07:26:04.000Z","author":[{"@type":"Person","name":"HuangChingChieh","url":"https://huangchingchieh.github.io/"}]}</script>
<script type="module" src="/blog/_nuxt/ClO9ClXx.js" crossorigin></script>
<script id="unhead:payload" type="application/json">{"title":"隨機手札","titleTemplate":"%s｜隨機手札"}</script></head><body><div id="__nuxt"><!--[--><!----><!--[--><header class="_header_7rhby_2 border-bottom border-primary border-2 position-sticky shadow-sm bg-foreground"><div class="container-md py-md-3 d-flex flex-row align-items-center"><!--[--><img src="/blog/pwa-64x64.png" height="64" width="64" class="common-icon rounded-circle shadow-sm bordered _bordered_t6qrn_2 _logo_7rhby_8"><div class="ms-3 flex-grow-1"><a href="/blog/" class="fw-bold text-body d-block text-decoration-none"> 隨機手札 </a><small class="text-muted d-none d-md-block">雜七雜八之地</small></div><div class="d-flex align-items-center justify-content-end"><div><button class="btn-link btn d-flex align-items-center text-decoration-none ms-3 ms-lg-4 d-flex p-0" type="button" title="文章分類"><!--[--><i class="bi-folder h5 mb-0 d-flex"></i><span class="ps-1"><!--[--><!--]--></span><!--]--></button><span></span></div><div style="display:none;"><button class="btn-link btn d-flex align-items-center text-decoration-none ms-3 ms-lg-4 d-flex p-0" type="button" title="文章摘要"><!--[--><i class="bi-card-list h5 mb-0 d-flex"></i><span class="ps-1"><!--[--><!--]--></span><!--]--></button><span></span></div><button class="btn-link btn d-flex align-items-center text-decoration-none ms-3 ms-lg-4 d-flex p-0" type="button"><!--[--><i class="bi-moon-stars h5 mb-0 d-flex"></i><span class="ps-1"><!--[--><!--]--></span><!--]--></button><div><button class="btn-link btn d-flex align-items-center text-decoration-none ms-3 ms-lg-4 d-flex p-0" type="button" title="搜尋文章"><!--[--><i class="bi-search h5 mb-0 d-flex"></i><span class="ps-1"><!--[--><!--]--></span><!--]--></button><span></span></div></div><!--]--></div></header><div class="mt-0 mt-lg-4"><main class="container-md py-4"><!--[--><!--[--><div class="col-lg-10 col-xl-8 col-12 mx-auto"><!--[--><div class="p-md-5 _container_1s3jf_3"><!--[--><article class="_article_13jpp_2"><h1 class="_title_13jpp_5">部落格Nuxt 2升級Nuxt 3（六）：Vuex → Pinia</h1><div class="d-flex flex-row align-items-center my-2"><time class="d-flex align-items-center flex-row text-muted small mb-0 _date_13jpp_11 me-3"><!--[--><i class="bi-calendar-event me-1"></i><span>2024/01/24</span><!--]--></time><span class="text-muted small d-inline-flex align-items-center me-3"><i class="bi-clock me-1"></i><span>5 min</span></span><a href="/blog/category/frontend/1/" class="text-muted small d-inline-flex align-items-center"><i class="bi-folder me-1"></i><span>前端筆記</span></a></div><div class="_tags_13jpp_14 d-flex flex-wrap my-2"><!--[--><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->blog<!--]--><!--]--></span><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->nuxt<!--]--><!--]--></span><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->vue<!--]--><!--]--></span><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->nuxt2<!--]--><!--]--></span><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->nuxt3<!--]--><!--]--></span><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->vuex<!--]--><!--]--></span><span class="badge bg-secondary text-bg-secondary d-inline-block fw-normal font-monospace me-1 mb-1"><!--[--> #<!--[-->pinia<!--]--><!--]--></span><!--]--></div><div class="position-relative rounded _banner_13jpp_17"><picture><!--[--><!--]--><img class="_img_5u372_2 rounded" src="https://imagizer.imageshack.com/v2/640x480q70/924/Ia2nWi.png" loading="lazy"></picture></div><div class="nuxt-content"><p><!--[--><a href="https://nuxt.com/docs/getting-started/state-management#using-third-party-libraries" target="_blank" rel="noopener noreferrer nofollow"><!--[--><!--[-->Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia<!--]--><!--]--></a>，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供<code class=""><!--[-->nuxtServerInit<!--]--></code>方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。<!--]--></p><p><!--[-->本來以為升級起來不會太困難，但踩了個小坑……。<!--]--></p><hr><h2 id="寫法差異"><!--[-->寫法差異<!--]--></h2><p><!--[-->這部份因為滿容易的，這邊僅列出官方文章做個參考紀錄：<!--]--></p><ul><!--[--><li><!--[--><a href="https://pinia.vuejs.org/ssr/nuxt.html" target="_blank" rel="noopener noreferrer nofollow"><!--[--><!--[-->Nuxt.js 整合指引<!--]--><!--]--></a><!--]--></li><li><!--[--><a href="https://pinia.vuejs.org/cookbook/migration-vuex.html" target="_blank" rel="noopener noreferrer nofollow"><!--[--><!--[-->Migrating from Vuex ≤ 4<!--]--><!--]--></a><!--]--></li><!--]--></ul><hr><h2 id="實作-nuxtserverinit"><!--[-->實作 nuxtServerInit<!--]--></h2><p><!--[-->之前在 Nuxt 2 中使用<code class=""><!--[-->nuxtServerInit<!--]--></code>，是因為我會在此處先處理並紀錄一些 metada（例如各分類的文章數量與頁數）以供元件使用，Nuxt 3 並無提供此方式，參考網路上文章之後可以透過「只在 server 端執行的<code class=""><!--[-->plugins<!--]--></code>」來完成：<!--]--></p><p><!--[-->首先在主要的<code class=""><!--[-->store<!--]--></code>下新增<code class=""><!--[-->index.js<!--]--></code>：<!--]--></p><div class="position-relative language-js shiki shiki-themes github-dark" code="import { defineStore } from &#39;pinia&#39;

import { getCategories, setPageCount } from &#39;~/utils/getCategories&#39;
import getTags from &#39;~/utils/getTags&#39;

export const useMainStore = defineStore(&#39;main&#39;, {
  state: () =&gt; ({
    someState: &#39;&#39;,
  }),
  actions: {
    nuxtServerInit() {
      // 這邊做原本nuxtServerInit要做的事
    },
  },
})
" meta style=""><div class="d-flex flex-row align-items-center text-white py-2 px-3 rounded-top bg-secondary"><div class="flex-grow-1 text-truncate pe-3 small fw-bold font-monospace">store/index.js</div><button class="btn-link btn p-0 d-flex align-items-center justify-content-center text-white" type="button"><!--[--><i class="bi-clipboard"></i><!--]--></button></div><div class="rounded-bottom bg-black"><pre class="_code_bvtnx_2"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { defineStore } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &#39;pinia&#39;
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { getCategories, setPageCount } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &#39;~/utils/getCategories&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> getTags </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &#39;~/utils/getTags&#39;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#F97583">export</span><span style="--shiki-default:#F97583"> const</span><span style="--shiki-default:#79B8FF"> useMainStore</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#B392F0"> defineStore</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;main&#39;</span><span style="--shiki-default:#E1E4E8">, {
</span></span><span class="line" line="7"><span style="--shiki-default:#B392F0">  state</span><span style="--shiki-default:#E1E4E8">: () </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> ({
</span></span><span class="line" line="8"><span style="--shiki-default:#E1E4E8">    someState: </span><span style="--shiki-default:#9ECBFF">&#39;&#39;</span><span style="--shiki-default:#E1E4E8">,
</span></span><span class="line" line="9"><span style="--shiki-default:#E1E4E8">  }),
</span></span><span class="line" line="10"><span style="--shiki-default:#E1E4E8">  actions: {
</span></span><span class="line" line="11"><span style="--shiki-default:#B392F0">    nuxtServerInit</span><span style="--shiki-default:#E1E4E8">() {
</span></span><span class="line" line="12"><span style="--shiki-default:#6A737D">      // 這邊做原本nuxtServerInit要做的事
</span></span><span class="line" line="13"><span style="--shiki-default:#E1E4E8">    },
</span></span><span class="line" line="14"><span style="--shiki-default:#E1E4E8">  },
</span></span><span class="line" line="15"><span style="--shiki-default:#E1E4E8">})
</span></span></code><!--]--></pre></div></div><p><!--[-->接著新增只在 server 端執行的 plugin，可以在命名後加上後綴字<code class=""><!--[-->.server.js<!--]--></code>來標明：<!--]--></p><div class="position-relative language-js shiki shiki-themes github-dark" code="import { useMainStore } from &#39;~/store&#39;

export default defineNuxtPlugin(async ({ $pinia }) =&gt; {
  const someAsyncData = await someAsyncFn()

  // 這邊引用前段宣告的store，記得要把context的$pinia傳進去。
  // 可參考：https://pinia.vuejs.org/ssr/nuxt.html#Awaiting-for-actions-in-pages
  const mainStore = useMainStore($pinia)
  mainStore.nuxtServerInit()
})
" meta style=""><div class="d-flex flex-row align-items-center text-white py-2 px-3 rounded-top bg-secondary"><div class="flex-grow-1 text-truncate pe-3 small fw-bold font-monospace">plugins/init.server.js</div><button class="btn-link btn p-0 d-flex align-items-center justify-content-center text-white" type="button"><!--[--><i class="bi-clipboard"></i><!--]--></button></div><div class="rounded-bottom bg-black"><pre class="_code_bvtnx_2"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> { useMainStore } </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &#39;~/store&#39;
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#F97583">export</span><span style="--shiki-default:#F97583"> default</span><span style="--shiki-default:#B392F0"> defineNuxtPlugin</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#F97583">async</span><span style="--shiki-default:#E1E4E8"> ({ </span><span style="--shiki-default:#FFAB70">$pinia</span><span style="--shiki-default:#E1E4E8"> }) </span><span style="--shiki-default:#F97583">=&gt;</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#F97583">  const</span><span style="--shiki-default:#79B8FF"> someAsyncData</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#F97583"> await</span><span style="--shiki-default:#B392F0"> someAsyncFn</span><span style="--shiki-default:#E1E4E8">()
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D">  // 這邊引用前段宣告的store，記得要把context的$pinia傳進去。
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">  // 可參考：https://pinia.vuejs.org/ssr/nuxt.html#Awaiting-for-actions-in-pages
</span></span><span class="line" line="8"><span style="--shiki-default:#F97583">  const</span><span style="--shiki-default:#79B8FF"> mainStore</span><span style="--shiki-default:#F97583"> =</span><span style="--shiki-default:#B392F0"> useMainStore</span><span style="--shiki-default:#E1E4E8">($pinia)
</span></span><span class="line" line="9"><span style="--shiki-default:#E1E4E8">  mainStore.</span><span style="--shiki-default:#B392F0">nuxtServerInit</span><span style="--shiki-default:#E1E4E8">()
</span></span><span class="line" line="10"><span style="--shiki-default:#E1E4E8">})
</span></span></code><!--]--></pre></div></div><p><!--[-->這樣就完成囉。<!--]--></p><hr><h2 id="在-ssr-端修改-state-的眉角"><!--[-->在 SSR 端修改 state 的眉角<!--]--></h2><p><!--[-->這中間踩了一個坑，本來以為是 Bug 但其實不是。<!--]--></p><p><!--[-->總之是這樣的，我在頁面中去修改了某個在 store 中的屬性，而在 layout 中順序比<code class=""><!--[-->&lt;slot /&gt;<!--]--></code>（也就是<code class=""><!--[-->&lt;NuxtPage /&gt;<!--]--></code>的置入點）前面的元件，若依賴了這個屬性去做<code class=""><!--[-->v-if<!--]--></code>的顯示，則會在直接進入頁面時出現<code class=""><!--[-->Hydration node mismatch<!--]--></code>的警告，暗示我 server 端與 client 端的元件長得不一樣（也就是資料不一致）。<!--]--></p><div class="position-relative language-vue shiki shiki-themes github-dark" code="&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 這裡面有個元素依賴了store的state切換顯示 --&gt;
    &lt;!-- TestHeader會出現Hydration node mismatch的問題 --&gt;
    &lt;TestHeader /&gt;

    &lt;!-- 我在頁面元件中修改了store的state --&gt;
    &lt;NuxtPage /&gt;

    &lt;!-- 放在NuxtPage後面的TestFooter不會出現同樣問題 --&gt;
    &lt;TestFooter /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import TestHeader from &#39;~/components/test-header.vue&#39;
import TestFooter from &#39;~/components/test-footer.vue&#39;
&lt;/script&gt;
" meta style=""><div class="d-flex flex-row align-items-center text-white py-2 px-3 rounded-top bg-secondary"><div class="flex-grow-1 text-truncate pe-3 small fw-bold font-monospace">layouts/default.vue</div><button class="btn-link btn p-0 d-flex align-items-center justify-content-center text-white" type="button"><!--[--><i class="bi-clipboard"></i><!--]--></button></div><div class="rounded-bottom bg-black"><pre class="_code_bvtnx_2"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#E1E4E8">&lt;</span><span style="--shiki-default:#85E89D">template</span><span style="--shiki-default:#E1E4E8">&gt;
</span></span><span class="line" line="2"><span style="--shiki-default:#E1E4E8">  &lt;</span><span style="--shiki-default:#85E89D">div</span><span style="--shiki-default:#E1E4E8">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D">    &lt;!-- 這裡面有個元素依賴了store的state切換顯示 --&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#6A737D">    &lt;!-- TestHeader會出現Hydration node mismatch的問題 --&gt;
</span></span><span class="line" line="5"><span style="--shiki-default:#E1E4E8">    &lt;</span><span style="--shiki-default:#85E89D">TestHeader</span><span style="--shiki-default:#E1E4E8"> /&gt;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">    &lt;!-- 我在頁面元件中修改了store的state --&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#E1E4E8">    &lt;</span><span style="--shiki-default:#85E89D">NuxtPage</span><span style="--shiki-default:#E1E4E8"> /&gt;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#6A737D">    &lt;!-- 放在NuxtPage後面的TestFooter不會出現同樣問題 --&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#E1E4E8">    &lt;</span><span style="--shiki-default:#85E89D">TestFooter</span><span style="--shiki-default:#E1E4E8"> /&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#E1E4E8">  &lt;/</span><span style="--shiki-default:#85E89D">div</span><span style="--shiki-default:#E1E4E8">&gt;
</span></span><span class="line" line="13"><span style="--shiki-default:#E1E4E8">&lt;/</span><span style="--shiki-default:#85E89D">template</span><span style="--shiki-default:#E1E4E8">&gt;
</span></span><span class="line" line="14"><span emptylineplaceholder="true">
</span></span><span class="line" line="15"><span style="--shiki-default:#E1E4E8">&lt;</span><span style="--shiki-default:#85E89D">script</span><span style="--shiki-default:#B392F0"> setup</span><span style="--shiki-default:#E1E4E8">&gt;
</span></span><span class="line" line="16"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> TestHeader </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &#39;~/components/test-header.vue&#39;
</span></span><span class="line" line="17"><span style="--shiki-default:#F97583">import</span><span style="--shiki-default:#E1E4E8"> TestFooter </span><span style="--shiki-default:#F97583">from</span><span style="--shiki-default:#9ECBFF"> &#39;~/components/test-footer.vue&#39;
</span></span><span class="line" line="18"><span style="--shiki-default:#E1E4E8">&lt;/</span><span style="--shiki-default:#85E89D">script</span><span style="--shiki-default:#E1E4E8">&gt;
</span></span></code><!--]--></pre></div></div><p><!--[-->幾經測試之後，發現好像是元件解析順序的問題，也在 Nuxt Github 的 Discussions 裡面有發現<a href="https://github.com/nuxt/nuxt/discussions/17011" target="_blank" rel="noopener noreferrer nofollow"><!--[--><!--[-->相關討論<!--]--><!--]--></a>：<!--]--></p><blockquote><!--[--><p><!--[-->This is a common SSR gotcha. The issue is that on SSR, Vue renders the HTML from top to bottom, outside to inside. And if you only fetch some data as you are rendering the &#39;inner&#39; part of the page, it doesn&#39;t rerender the layout at the top of the page. (On client-side it&#39;s fine as can be reactive.) So if you have a common piece you rely on for rendering your page, make sure to fetch it in the layout, a plugin, or a middleware - somewhere outside of the rendering process.<!--]--></p><!--]--></blockquote><p><!--[-->沒錯，如 Nuxt 團隊的領導人所說：這是一個「common SSR gotcha」（常見的 SSR 問題），無法被解決，只能在開發時自己小心了（是說 Nuxt 2 沒這問題呀……還是只是沒 WARN 而已？）。<!--]--></p><p><!--[-->目前因為是 SEO 不敏感的區塊所以還好，解法是直接先把那一個區塊用<code class=""><!--[-->&lt;ClientOnly&gt;<!--]--></code>包起來，只是未來若遇到這樣的情境，而區塊剛好是 SEO 敏感的區塊……可能就要想想怎麼做了。<!--]--></p><hr><h2 id="後記"><!--[-->後記<!--]--></h2><p><!--[-->大概是這樣，只能說 Nuxt 2 升 3 的坑其實不少啊……（顯示為精疲力盡）。<!--]--></p><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div></article><!--]--></div><hr class="d-md-none d-block"><a href="https://ko-fi.com/chaoschaoshuang" target="_blank" rel="noopener noreferrer " class="mt-5 d-flex justify-content-center"><!--[--><img src="/blog/images/donation/kofi_button_blue.png" alt="Support me on Ko-fi" class="img-fluid d-block" width="200"><!--]--></a><div class="giscus mt-5"></div><div class="d-flex flex-column mt-5"><h5 class="mb-0"><div class="d-inline-block">相關文章 <div class="w-50 border-bottom border-primary border-2 mt-2"></div></div></h5><div class="mt-4 flex-grow-1"><!--[--><!--[--><a href="/blog/nuxt2_to_nuxt3_blog_1_ui/" class="d-flex flex-column flex-lg-row text-decoration-none p-3 p-lg-4 rounded shadow-sm bg-foreground mb-3"><picture class="_img_1ygqe_2 me-lg-3 rounded"><!--[--><!--]--><img class="_img_5u372_2 rounded _img_1ygqe_2" src="https://imagizer.imageshack.com/v2/640x480q70/924/Ia2nWi.png" loading="lazy"></picture><div class="d-flex flex-column flex-grow-1"><h4 class="_title_1nrvw_2 text-line-2 mt-2 pt-1 pt-lg-0 mt-lg-0 mb-2 mb-lg-3"><!--[-->部落格Nuxt 2升級Nuxt 3（一）：bootstrapVue置換成自製的bootrap5元件<!--]--></h4><p class="text-muted text-line-2 _description_3l36l_2 mb-0" title="如之前規劃，部落格升級 Nuxt3 的第一步是先把 bootstrapVue 抽換成自己實做的 bootstrap5。這篇是紀錄過程中覺得特別困難或是需要研究的部份。">如之前規劃，部落格升級 Nuxt3 的第一步是先把 bootstrapVue 抽換成自己實做的 bootstrap5。這篇是紀錄過程中覺得特別困難或是需要研究的部份。</p><div class="d-flex flex-row flex-grow-1 align-items-end mt-2 mt-lg-0"><time class="d-flex align-items-center flex-row text-muted small mb-0 flex-grow-1"><!--[--><i class="bi-pencil-square me-1"></i><span>2024/01/24</span><!--]--></time><span class="text-muted small d-inline-flex align-items-center"><i class="bi-clock me-1"></i><span>4 min</span></span></div></div></a><a href="/blog/nuxt2_to_nuxt3_blog_0_intro/" class="d-flex flex-column flex-lg-row text-decoration-none p-3 p-lg-4 rounded shadow-sm bg-foreground mb-3"><picture class="_img_1ygqe_2 me-lg-3 rounded"><!--[--><!--]--><img class="_img_5u372_2 rounded _img_1ygqe_2" src="https://imagizer.imageshack.com/v2/640x480q70/924/Ia2nWi.png" loading="lazy"></picture><div class="d-flex flex-column flex-grow-1"><h4 class="_title_1nrvw_2 text-line-2 mt-2 pt-1 pt-lg-0 mt-lg-0 mb-2 mb-lg-3"><!--[-->部落格Nuxt 2升級Nuxt 3：前言<!--]--></h4><p class="text-muted text-line-2 _description_3l36l_2 mb-0" title="從去年年初開始建置的這個部落格網站，邊寫文章的同時陸陸續續補上功能後，大概到上個月才終於像是有個部落格的樣子。但由於 Nuxt2 即將在 2024/06/30 停止官方支援，而作為基底的 Vue2 更是在 2023/12/31 已停止官方支援，所以……想說要做的新功能可能先放著，先把部落格從 Nuxt2 升級到 Nuxt3 比較好。">從去年年初開始建置的這個部落格網站，邊寫文章的同時陸陸續續補上功能後，大概到上個月才終於像是有個部落格的樣子。但由於 Nuxt2 即將在 2024/06/30 停止官方支援，而作為基底的 Vue2 更是在 2023/12/31 已停止官方支援，所以……想說要做的新功能可能先放著，先把部落格從 Nuxt2 升級到 Nuxt3 比較好。</p><div class="d-flex flex-row flex-grow-1 align-items-end mt-2 mt-lg-0"><time class="d-flex align-items-center flex-row text-muted small mb-0 flex-grow-1"><!--[--><i class="bi-pencil-square me-1"></i><span>2024/01/24</span><!--]--></time><span class="text-muted small d-inline-flex align-items-center"><i class="bi-clock me-1"></i><span>5 min</span></span></div></div></a><a href="/blog/nuxt2_to_nuxt3_blog_5_modules_sitemap/" class="d-flex flex-column flex-lg-row text-decoration-none p-3 p-lg-4 rounded shadow-sm bg-foreground mb-3"><picture class="_img_1ygqe_2 me-lg-3 rounded"><!--[--><!--]--><img class="_img_5u372_2 rounded _img_1ygqe_2" src="https://imagizer.imageshack.com/v2/640x480q70/924/Ia2nWi.png" loading="lazy"></picture><div class="d-flex flex-column flex-grow-1"><h4 class="_title_1nrvw_2 text-line-2 mt-2 pt-1 pt-lg-0 mt-lg-0 mb-2 mb-lg-3"><!--[-->部落格Nuxt 2升級Nuxt 3（五）：Sitemap模組升級<!--]--></h4><p class="text-muted text-line-2 _description_3l36l_2 mb-0" title="原本使用的 Sitemap 模組 @nuxtjs/sitemap 有支援 Nuxt 3 的版本，所以升級起來不如前面幾篇困難，主要就是修改一下設定值而已。">原本使用的 Sitemap 模組 @nuxtjs/sitemap 有支援 Nuxt 3 的版本，所以升級起來不如前面幾篇困難，主要就是修改一下設定值而已。</p><div class="d-flex flex-row flex-grow-1 align-items-end mt-2 mt-lg-0"><time class="d-flex align-items-center flex-row text-muted small mb-0 flex-grow-1"><!--[--><i class="bi-calendar-event me-1"></i><span>2024/01/24</span><!--]--></time><span class="text-muted small d-inline-flex align-items-center"><i class="bi-clock me-1"></i><span>2 min</span></span></div></div></a><!--]--><!--]--></div></div><!--]--></div><!--]--><!--]--></main></div><footer class="pb-3 pb-lg-5 _footer_4zxf0_2 mt-4"><div class="container-md text-white"><!--[--><div class="row"><!--[--><div class="col-md-4 col-12 mt-3 mt-lg-5"><!--[--><div class="fw-bold mb-2 d-flex align-items-center h6 text-primary"><!--[--><a href="/blog/buy_me_a_tea#%E9%97%9C%E6%96%BC%E6%88%91" class="text-primary">關於我</a><!--[--><img src="/blog/pwa-64x64.png" height="16" width="16" class="common-icon rounded-circle shadow-sm ms-2"><!--]--><!--]--></div><div class="small"><!--[--><!--[--> 工作時若不喝上一杯飲料就無法做事的前端小碼農。三大前端框架陣營中屬於 Vue 陣營。 <!--]--><!--]--></div><!--]--></div><div class="col-md-4 col-12 mt-3 mt-lg-5"><!--[--><div class="fw-bold mb-2 d-flex align-items-center h6 text-primary"><!--[--><a href="/blog/buy_me_a_tea#%E9%97%9C%E6%96%BC%E9%9A%A8%E6%A9%9F%E6%89%8B%E6%9C%AD" class="text-primary">關於隨機手札</a><!--[--><!--]--><!--]--></div><div class="small"><!--[--><!--[--> 使用 <a href="https://v2.nuxt.com/" target="_blank" rel="noopener noreferrer " class="text-white"><!--[--><!--[--> Nuxt 2 <!--]--><!--]--></a> 建置於 <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer " class="text-white"><!--[--><!--[--> Github Pages <!--]--><!--]--></a> 上，全站文字皆在 <a href="https://creativecommons.org/licenses/by-nd/4.0/legalcode.zh-hant" target="_blank" rel="noopener noreferrer " class="text-white"><!--[--><!--[--> 創用CC BY-ND 4.0 條款 <!--]--><!--]--></a> 下提供。 <!--]--><!--]--></div><!--]--></div><div class="col-md-4 col-12 mt-3 mt-lg-5"><!--[--><div class="fw-bold mb-2 d-flex align-items-center h6 text-primary"><!--[--><a href="/blog/buy_me_a_tea#%E8%AB%8B%E6%88%91%E5%96%9D%E6%9D%AF%E6%89%8B%E6%90%96%E9%A3%B2%E5%90%A7%EF%BC%81" class="text-primary">請我喝杯手搖飲吧！</a><!--[--><!--]--><!--]--></div><div class="small"><!--[--><!--[--> 若這裡的經驗分享有幫助到你，可以透過<a href="https://ko-fi.com/chaoschaoshuang" target="_blank" rel="noopener noreferrer " class="text-white"><!--[--><!--[--> Ko-fi <!--]--><!--]--></a>請我喝杯手搖飲哦！ <!--]--><!--]--></div><!--]--></div><!--]--></div><!--]--></div></footer><!--]--><span></span><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/blog/nuxt2_to_nuxt3_blog_6_modules_pinia/_payload.json?6e3de1d4-c2bd-4240-a0de-3cd3ad7a51b4">[{"state":1,"once":7,"_errors":8,"serverRendered":11,"path":12,"pinia":13,"prerenderedAt":48},["Reactive",2],{"$ssite-config":3},{"env":4,"name":5,"url":6},"production","blog","https://huangchingchieh.github.io",["Set"],["ShallowReactive",9],{"search:":10,"nuxt2_to_nuxt3_blog_6_modules_pinia":10,"titleMap":10,"Related_nuxt2_to_nuxt3_blog_6_modules_pinia":10,"articles":10,"titleMap:":10},null,true,"/nuxt2_to_nuxt3_blog_6_modules_pinia/",["Reactive",14],{"main":15,"theme":47},{"tagsObj":16,"categories":26,"articlesMetadata":35,"toc":36},{"部落格":17,"關於我":18,"贊助":18,"罐頭":18,"飲食":18,"portfolio":18,"collections":18,"defi":19,"冷錢包":18,"加密貨幣":19,"ftx":18,"投資":17,"流動性挖礦":17,"fedora":20,"intel turbo boost":18,"docker":19,"android":21,"custom rom":19,"gooel pixel 3a":19,"lineageos":19,"mega":18,"megasync":18,"雲端硬碟":18,"rar":18,"unrar":18,"youtube":18,"zram":18,"自由潛水":18,"潛水":18,"linux":18,"windows":17,"macbook air":18,"apple":18,"舊筆電復活":17,"德國男歌手":18,"音樂":18,"css":18,"html":18,"chrome":18,"vue":20,"nuxt":22,"bootstrap":17,"nuxt2":23,"nuxt content v1":18,"nuxt content":17,"markdown":18,"sitemap":17,"沖繩":24,"自助旅行":24,"自由行":24,"okinawa":24,"首里城":18,"單軌列車":17,"沖繩蕎麥麵":18,"敘敘院燒肉":18,"a&w":18,"豬肉蛋飯糰":18,"貢茶":18,"吉野家":18,"琉球新麵通堂":18,"blue seal":18,"波上宮":18,"沖繩縣立博物館・美術館":18,"住宿":18,"東急":18,"tokyu stay":18,"觀光巴士":17,"萬座毛":18,"古宇利島":18,"美麗海水族館":18,"美國村":18,"知念岬":18,"玉泉洞":18,"王國村":18,"沖繩世界":18,"糸満漁市場":18,"ashibinaa":18,"outlet":18,"瀨長島":18,"額外收入":18,"問卷調查":18,"ubuntu":17,"swap":18,"社會議題":17,"lgbt":17,"翻譯":17,"usb":18,"安裝":18,"重灌":18,"chromeos flex":18,"chromeos":18,"asus":18,"asus e203na":18,"medium":18,"blogger":18,"matters":18,"github pages":18,"podman":18,"vscode":17,"devcontainer":17,"blog":25,"nuxt3":23,"bootstrapvue":18,"bootstrap 4":18,"bootstrap 5":18,"pwa":17,"vuex":18,"pinia":18,"vite-pwa":18,"pm2":18},2,1,3,12,4,13,8,6,7,{"life":27,"frontend":29,"linux":30,"all":32},{"count":28,"pageCount":17},17,{"count":28,"pageCount":17},{"count":31,"pageCount":17},15,{"count":33,"pageCount":34},49,5,{"count":33,"pageCount":34},[37,39,42,45],{"id":38,"depth":17,"text":38},"寫法差異",{"id":40,"depth":17,"text":41},"實作-nuxtserverinit","實作 nuxtServerInit",{"id":43,"depth":17,"text":44},"在-ssr-端修改-state-的眉角","在 SSR 端修改 state 的眉角",{"id":46,"depth":17,"text":46},"後記",{"dark":10,"preferDark":11},1732936420349]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{base:"/blog/",imageServer:"https://imagizer.imageshack.com/v2/",appHost:"https://huangchingchieh.github.io/blog/",perPage:10,categoriesMap:{all:"最新文章",linux:"Linux心得",frontend:"前端筆記",life:"生活雜記"},description:"一個非本科系的前端小碼農，紀錄一些身為前端小碼農的技術筆記、使用Linux（主要是Fedora）的心得，以及生活上雜七雜八的事情。",isDev:false,mdc:{components:{prose:true,map:{p:"prose-p",a:"ArticleOuterLink",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr",pre:"ArticleCode"}},headings:{anchorLinks:{h1:false,h2:false,h3:false,h4:false,h5:false,h6:false}}},content:{locales:[],defaultLocale:"",integrity:1732936392889,experimental:{stripQueryParameters:false,advanceQuery:false,clientDB:false},respectPathCase:false,api:{baseURL:"/api/_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"ArticleOuterLink",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr",pre:"ArticleCode"},highlight:{theme:"github-dark",highlighter:"shiki",shikiEngine:"oniguruma",langs:["js","jsx","json","ts","tsx","vue","css","html","bash","md","mdc","yaml"]},wsUrl:"",documentDriven:false,host:"",trailingSlash:false,search:{indexed:true,ignoredTags:["script","style","pre"],filterQuery:{_draft:false,_partial:false},options:{fields:["title","content","titles"],storeFields:["title","content","titles"],searchOptions:{prefix:true,fuzzy:.2,boost:{title:4,content:2,titles:1}}}},contentHead:true,anchorLinks:false}},app:{baseURL:"/blog/",buildId:"6e3de1d4-c2bd-4240-a0de-3cd3ad7a51b4",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>