[{"data":1,"prerenderedAt":1055},["ShallowReactive",2],{"nuxt2_to_nuxt3_blog_6_modules_pinia":3,"Related_nuxt2_to_nuxt3_blog_6_modules_pinia":1019},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"img":10,"tags":11,"category":19,"readingTime":20,"excerpt":25,"body":54,"_type":1011,"_id":1012,"_source":1013,"_file":1014,"_stem":1015,"_extension":1016,"createdAt":1017,"updatedAt":1017,"slug":1018},"/articles/2024/nuxt2_to_nuxt3_blog_6_modules_pinia","2024",false,"","部落格Nuxt 2升級Nuxt 3（六）：Vuex → Pinia","Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供nuxtServerInit方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。","924/Ia2nWi.png",[12,13,14,15,16,17,18],"blog","nuxt","vue","nuxt2","nuxt3","vuex","pinia","frontend",{"text":21,"minutes":22,"time":23,"words":24},"5 min read",4.19,251400,838,{"type":26,"children":27},"root",[28],{"type":29,"tag":30,"props":31,"children":32},"element","p",{},[33,43,45,52],{"type":29,"tag":34,"props":35,"children":39},"a",{"href":36,"rel":37},"https://nuxt.com/docs/getting-started/state-management#using-third-party-libraries",[38],"nofollow",[40],{"type":41,"value":42},"text","Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia",{"type":41,"value":44},"，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供",{"type":29,"tag":46,"props":47,"children":49},"code",{"className":48},[],[50],{"type":41,"value":51},"nuxtServerInit",{"type":41,"value":53},"方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。",{"type":26,"children":55,"toc":1005},[56,71,76,80,86,91,116,119,125,145,166,426,439,629,634,637,643,648,685,946,959,968,973,986,989,994,999],{"type":29,"tag":30,"props":57,"children":58},{},[59,64,65,70],{"type":29,"tag":34,"props":60,"children":62},{"href":36,"rel":61},[38],[63],{"type":41,"value":42},{"type":41,"value":44},{"type":29,"tag":46,"props":66,"children":68},{"className":67},[],[69],{"type":41,"value":51},{"type":41,"value":53},{"type":29,"tag":30,"props":72,"children":73},{},[74],{"type":41,"value":75},"本來以為升級起來不會太困難，但踩了個小坑……。",{"type":29,"tag":77,"props":78,"children":79},"hr",{},[],{"type":29,"tag":81,"props":82,"children":84},"h2",{"id":83},"寫法差異",[85],{"type":41,"value":83},{"type":29,"tag":30,"props":87,"children":88},{},[89],{"type":41,"value":90},"這部份因為滿容易的，這邊僅列出官方文章做個參考紀錄：",{"type":29,"tag":92,"props":93,"children":94},"ul",{},[95,106],{"type":29,"tag":96,"props":97,"children":98},"li",{},[99],{"type":29,"tag":34,"props":100,"children":103},{"href":101,"rel":102},"https://pinia.vuejs.org/ssr/nuxt.html",[38],[104],{"type":41,"value":105},"Nuxt.js 整合指引",{"type":29,"tag":96,"props":107,"children":108},{},[109],{"type":29,"tag":34,"props":110,"children":113},{"href":111,"rel":112},"https://pinia.vuejs.org/cookbook/migration-vuex.html",[38],[114],{"type":41,"value":115},"Migrating from Vuex ≤ 4",{"type":29,"tag":77,"props":117,"children":118},{},[],{"type":29,"tag":81,"props":120,"children":122},{"id":121},"實作-nuxtserverinit",[123],{"type":41,"value":124},"實作 nuxtServerInit",{"type":29,"tag":30,"props":126,"children":127},{},[128,130,135,137,143],{"type":41,"value":129},"之前在 Nuxt 2 中使用",{"type":29,"tag":46,"props":131,"children":133},{"className":132},[],[134],{"type":41,"value":51},{"type":41,"value":136},"，是因為我會在此處先處理並紀錄一些 metada（例如各分類的文章數量與頁數）以供元件使用，Nuxt 3 並無提供此方式，參考網路上文章之後可以透過「只在 server 端執行的",{"type":29,"tag":46,"props":138,"children":140},{"className":139},[],[141],{"type":41,"value":142},"plugins",{"type":41,"value":144},"」來完成：",{"type":29,"tag":30,"props":146,"children":147},{},[148,150,156,158,164],{"type":41,"value":149},"首先在主要的",{"type":29,"tag":46,"props":151,"children":153},{"className":152},[],[154],{"type":41,"value":155},"store",{"type":41,"value":157},"下新增",{"type":29,"tag":46,"props":159,"children":161},{"className":160},[],[162],{"type":41,"value":163},"index.js",{"type":41,"value":165},"：",{"type":29,"tag":167,"props":168,"children":173},"pre",{"className":169,"code":170,"filename":171,"language":172,"meta":7,"style":7},"language-js shiki shiki-themes github-dark","import { defineStore } from 'pinia'\n\nimport { getCategories, setPageCount } from '~/utils/getCategories'\nimport getTags from '~/utils/getTags'\n\nexport const useMainStore = defineStore('main', {\n  state: () => ({\n    someState: '',\n  }),\n  actions: {\n    nuxtServerInit() {\n      // 這邊做原本nuxtServerInit要做的事\n    },\n  },\n})\n","store/index.js","js",[174],{"type":29,"tag":46,"props":175,"children":176},{"__ignoreMap":7},[177,206,216,238,260,268,314,338,357,366,375,389,399,408,417],{"type":29,"tag":178,"props":179,"children":182},"span",{"class":180,"line":181},"line",1,[183,189,195,200],{"type":29,"tag":178,"props":184,"children":186},{"style":185},"--shiki-default:#F97583",[187],{"type":41,"value":188},"import",{"type":29,"tag":178,"props":190,"children":192},{"style":191},"--shiki-default:#E1E4E8",[193],{"type":41,"value":194}," { defineStore } ",{"type":29,"tag":178,"props":196,"children":197},{"style":185},[198],{"type":41,"value":199},"from",{"type":29,"tag":178,"props":201,"children":203},{"style":202},"--shiki-default:#9ECBFF",[204],{"type":41,"value":205}," 'pinia'\n",{"type":29,"tag":178,"props":207,"children":209},{"class":180,"line":208},2,[210],{"type":29,"tag":178,"props":211,"children":213},{"emptyLinePlaceholder":212},true,[214],{"type":41,"value":215},"\n",{"type":29,"tag":178,"props":217,"children":219},{"class":180,"line":218},3,[220,224,229,233],{"type":29,"tag":178,"props":221,"children":222},{"style":185},[223],{"type":41,"value":188},{"type":29,"tag":178,"props":225,"children":226},{"style":191},[227],{"type":41,"value":228}," { getCategories, setPageCount } ",{"type":29,"tag":178,"props":230,"children":231},{"style":185},[232],{"type":41,"value":199},{"type":29,"tag":178,"props":234,"children":235},{"style":202},[236],{"type":41,"value":237}," '~/utils/getCategories'\n",{"type":29,"tag":178,"props":239,"children":241},{"class":180,"line":240},4,[242,246,251,255],{"type":29,"tag":178,"props":243,"children":244},{"style":185},[245],{"type":41,"value":188},{"type":29,"tag":178,"props":247,"children":248},{"style":191},[249],{"type":41,"value":250}," getTags ",{"type":29,"tag":178,"props":252,"children":253},{"style":185},[254],{"type":41,"value":199},{"type":29,"tag":178,"props":256,"children":257},{"style":202},[258],{"type":41,"value":259}," '~/utils/getTags'\n",{"type":29,"tag":178,"props":261,"children":263},{"class":180,"line":262},5,[264],{"type":29,"tag":178,"props":265,"children":266},{"emptyLinePlaceholder":212},[267],{"type":41,"value":215},{"type":29,"tag":178,"props":269,"children":271},{"class":180,"line":270},6,[272,277,282,288,293,299,304,309],{"type":29,"tag":178,"props":273,"children":274},{"style":185},[275],{"type":41,"value":276},"export",{"type":29,"tag":178,"props":278,"children":279},{"style":185},[280],{"type":41,"value":281}," const",{"type":29,"tag":178,"props":283,"children":285},{"style":284},"--shiki-default:#79B8FF",[286],{"type":41,"value":287}," useMainStore",{"type":29,"tag":178,"props":289,"children":290},{"style":185},[291],{"type":41,"value":292}," =",{"type":29,"tag":178,"props":294,"children":296},{"style":295},"--shiki-default:#B392F0",[297],{"type":41,"value":298}," defineStore",{"type":29,"tag":178,"props":300,"children":301},{"style":191},[302],{"type":41,"value":303},"(",{"type":29,"tag":178,"props":305,"children":306},{"style":202},[307],{"type":41,"value":308},"'main'",{"type":29,"tag":178,"props":310,"children":311},{"style":191},[312],{"type":41,"value":313},", {\n",{"type":29,"tag":178,"props":315,"children":317},{"class":180,"line":316},7,[318,323,328,333],{"type":29,"tag":178,"props":319,"children":320},{"style":295},[321],{"type":41,"value":322},"  state",{"type":29,"tag":178,"props":324,"children":325},{"style":191},[326],{"type":41,"value":327},": () ",{"type":29,"tag":178,"props":329,"children":330},{"style":185},[331],{"type":41,"value":332},"=>",{"type":29,"tag":178,"props":334,"children":335},{"style":191},[336],{"type":41,"value":337}," ({\n",{"type":29,"tag":178,"props":339,"children":341},{"class":180,"line":340},8,[342,347,352],{"type":29,"tag":178,"props":343,"children":344},{"style":191},[345],{"type":41,"value":346},"    someState: ",{"type":29,"tag":178,"props":348,"children":349},{"style":202},[350],{"type":41,"value":351},"''",{"type":29,"tag":178,"props":353,"children":354},{"style":191},[355],{"type":41,"value":356},",\n",{"type":29,"tag":178,"props":358,"children":360},{"class":180,"line":359},9,[361],{"type":29,"tag":178,"props":362,"children":363},{"style":191},[364],{"type":41,"value":365},"  }),\n",{"type":29,"tag":178,"props":367,"children":369},{"class":180,"line":368},10,[370],{"type":29,"tag":178,"props":371,"children":372},{"style":191},[373],{"type":41,"value":374},"  actions: {\n",{"type":29,"tag":178,"props":376,"children":378},{"class":180,"line":377},11,[379,384],{"type":29,"tag":178,"props":380,"children":381},{"style":295},[382],{"type":41,"value":383},"    nuxtServerInit",{"type":29,"tag":178,"props":385,"children":386},{"style":191},[387],{"type":41,"value":388},"() {\n",{"type":29,"tag":178,"props":390,"children":392},{"class":180,"line":391},12,[393],{"type":29,"tag":178,"props":394,"children":396},{"style":395},"--shiki-default:#6A737D",[397],{"type":41,"value":398},"      // 這邊做原本nuxtServerInit要做的事\n",{"type":29,"tag":178,"props":400,"children":402},{"class":180,"line":401},13,[403],{"type":29,"tag":178,"props":404,"children":405},{"style":191},[406],{"type":41,"value":407},"    },\n",{"type":29,"tag":178,"props":409,"children":411},{"class":180,"line":410},14,[412],{"type":29,"tag":178,"props":413,"children":414},{"style":191},[415],{"type":41,"value":416},"  },\n",{"type":29,"tag":178,"props":418,"children":420},{"class":180,"line":419},15,[421],{"type":29,"tag":178,"props":422,"children":423},{"style":191},[424],{"type":41,"value":425},"})\n",{"type":29,"tag":30,"props":427,"children":428},{},[429,431,437],{"type":41,"value":430},"接著新增只在 server 端執行的 plugin，可以在命名後加上後綴字",{"type":29,"tag":46,"props":432,"children":434},{"className":433},[],[435],{"type":41,"value":436},".server.js",{"type":41,"value":438},"來標明：",{"type":29,"tag":167,"props":440,"children":443},{"className":169,"code":441,"filename":442,"language":172,"meta":7,"style":7},"import { useMainStore } from '~/store'\n\nexport default defineNuxtPlugin(async ({ $pinia }) => {\n  const someAsyncData = await someAsyncFn()\n\n  // 這邊引用前段宣告的store，記得要把context的$pinia傳進去。\n  // 可參考：https://pinia.vuejs.org/ssr/nuxt.html#Awaiting-for-actions-in-pages\n  const mainStore = useMainStore($pinia)\n  mainStore.nuxtServerInit()\n})\n","plugins/init.server.js",[444],{"type":29,"tag":46,"props":445,"children":446},{"__ignoreMap":7},[447,468,475,526,558,565,573,581,606,622],{"type":29,"tag":178,"props":448,"children":449},{"class":180,"line":181},[450,454,459,463],{"type":29,"tag":178,"props":451,"children":452},{"style":185},[453],{"type":41,"value":188},{"type":29,"tag":178,"props":455,"children":456},{"style":191},[457],{"type":41,"value":458}," { useMainStore } ",{"type":29,"tag":178,"props":460,"children":461},{"style":185},[462],{"type":41,"value":199},{"type":29,"tag":178,"props":464,"children":465},{"style":202},[466],{"type":41,"value":467}," '~/store'\n",{"type":29,"tag":178,"props":469,"children":470},{"class":180,"line":208},[471],{"type":29,"tag":178,"props":472,"children":473},{"emptyLinePlaceholder":212},[474],{"type":41,"value":215},{"type":29,"tag":178,"props":476,"children":477},{"class":180,"line":218},[478,482,487,492,496,501,506,512,517,521],{"type":29,"tag":178,"props":479,"children":480},{"style":185},[481],{"type":41,"value":276},{"type":29,"tag":178,"props":483,"children":484},{"style":185},[485],{"type":41,"value":486}," default",{"type":29,"tag":178,"props":488,"children":489},{"style":295},[490],{"type":41,"value":491}," defineNuxtPlugin",{"type":29,"tag":178,"props":493,"children":494},{"style":191},[495],{"type":41,"value":303},{"type":29,"tag":178,"props":497,"children":498},{"style":185},[499],{"type":41,"value":500},"async",{"type":29,"tag":178,"props":502,"children":503},{"style":191},[504],{"type":41,"value":505}," ({ ",{"type":29,"tag":178,"props":507,"children":509},{"style":508},"--shiki-default:#FFAB70",[510],{"type":41,"value":511},"$pinia",{"type":29,"tag":178,"props":513,"children":514},{"style":191},[515],{"type":41,"value":516}," }) ",{"type":29,"tag":178,"props":518,"children":519},{"style":185},[520],{"type":41,"value":332},{"type":29,"tag":178,"props":522,"children":523},{"style":191},[524],{"type":41,"value":525}," {\n",{"type":29,"tag":178,"props":527,"children":528},{"class":180,"line":240},[529,534,539,543,548,553],{"type":29,"tag":178,"props":530,"children":531},{"style":185},[532],{"type":41,"value":533},"  const",{"type":29,"tag":178,"props":535,"children":536},{"style":284},[537],{"type":41,"value":538}," someAsyncData",{"type":29,"tag":178,"props":540,"children":541},{"style":185},[542],{"type":41,"value":292},{"type":29,"tag":178,"props":544,"children":545},{"style":185},[546],{"type":41,"value":547}," await",{"type":29,"tag":178,"props":549,"children":550},{"style":295},[551],{"type":41,"value":552}," someAsyncFn",{"type":29,"tag":178,"props":554,"children":555},{"style":191},[556],{"type":41,"value":557},"()\n",{"type":29,"tag":178,"props":559,"children":560},{"class":180,"line":262},[561],{"type":29,"tag":178,"props":562,"children":563},{"emptyLinePlaceholder":212},[564],{"type":41,"value":215},{"type":29,"tag":178,"props":566,"children":567},{"class":180,"line":270},[568],{"type":29,"tag":178,"props":569,"children":570},{"style":395},[571],{"type":41,"value":572},"  // 這邊引用前段宣告的store，記得要把context的$pinia傳進去。\n",{"type":29,"tag":178,"props":574,"children":575},{"class":180,"line":316},[576],{"type":29,"tag":178,"props":577,"children":578},{"style":395},[579],{"type":41,"value":580},"  // 可參考：https://pinia.vuejs.org/ssr/nuxt.html#Awaiting-for-actions-in-pages\n",{"type":29,"tag":178,"props":582,"children":583},{"class":180,"line":340},[584,588,593,597,601],{"type":29,"tag":178,"props":585,"children":586},{"style":185},[587],{"type":41,"value":533},{"type":29,"tag":178,"props":589,"children":590},{"style":284},[591],{"type":41,"value":592}," mainStore",{"type":29,"tag":178,"props":594,"children":595},{"style":185},[596],{"type":41,"value":292},{"type":29,"tag":178,"props":598,"children":599},{"style":295},[600],{"type":41,"value":287},{"type":29,"tag":178,"props":602,"children":603},{"style":191},[604],{"type":41,"value":605},"($pinia)\n",{"type":29,"tag":178,"props":607,"children":608},{"class":180,"line":359},[609,614,618],{"type":29,"tag":178,"props":610,"children":611},{"style":191},[612],{"type":41,"value":613},"  mainStore.",{"type":29,"tag":178,"props":615,"children":616},{"style":295},[617],{"type":41,"value":51},{"type":29,"tag":178,"props":619,"children":620},{"style":191},[621],{"type":41,"value":557},{"type":29,"tag":178,"props":623,"children":624},{"class":180,"line":368},[625],{"type":29,"tag":178,"props":626,"children":627},{"style":191},[628],{"type":41,"value":425},{"type":29,"tag":30,"props":630,"children":631},{},[632],{"type":41,"value":633},"這樣就完成囉。",{"type":29,"tag":77,"props":635,"children":636},{},[],{"type":29,"tag":81,"props":638,"children":640},{"id":639},"在-ssr-端修改-state-的眉角",[641],{"type":41,"value":642},"在 SSR 端修改 state 的眉角",{"type":29,"tag":30,"props":644,"children":645},{},[646],{"type":41,"value":647},"這中間踩了一個坑，本來以為是 Bug 但其實不是。",{"type":29,"tag":30,"props":649,"children":650},{},[651,653,659,661,667,669,675,677,683],{"type":41,"value":652},"總之是這樣的，我在頁面中去修改了某個在 store 中的屬性，而在 layout 中順序比",{"type":29,"tag":46,"props":654,"children":656},{"className":655},[],[657],{"type":41,"value":658},"\u003Cslot />",{"type":41,"value":660},"（也就是",{"type":29,"tag":46,"props":662,"children":664},{"className":663},[],[665],{"type":41,"value":666},"\u003CNuxtPage />",{"type":41,"value":668},"的置入點）前面的元件，若依賴了這個屬性去做",{"type":29,"tag":46,"props":670,"children":672},{"className":671},[],[673],{"type":41,"value":674},"v-if",{"type":41,"value":676},"的顯示，則會在直接進入頁面時出現",{"type":29,"tag":46,"props":678,"children":680},{"className":679},[],[681],{"type":41,"value":682},"Hydration node mismatch",{"type":41,"value":684},"的警告，暗示我 server 端與 client 端的元件長得不一樣（也就是資料不一致）。",{"type":29,"tag":167,"props":686,"children":690},{"className":687,"code":688,"filename":689,"language":14,"meta":7,"style":7},"language-vue shiki shiki-themes github-dark","\u003Ctemplate>\n  \u003Cdiv>\n    \u003C!-- 這裡面有個元素依賴了store的state切換顯示 -->\n    \u003C!-- TestHeader會出現Hydration node mismatch的問題 -->\n    \u003CTestHeader />\n\n    \u003C!-- 我在頁面元件中修改了store的state -->\n    \u003CNuxtPage />\n\n    \u003C!-- 放在NuxtPage後面的TestFooter不會出現同樣問題 -->\n    \u003CTestFooter />\n  \u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport TestHeader from '~/components/test-header.vue'\nimport TestFooter from '~/components/test-footer.vue'\n\u003C/script>\n","layouts/default.vue",[691],{"type":29,"tag":46,"props":692,"children":693},{"__ignoreMap":7},[694,713,730,738,746,764,771,779,795,802,810,826,842,858,865,886,908,930],{"type":29,"tag":178,"props":695,"children":696},{"class":180,"line":181},[697,702,708],{"type":29,"tag":178,"props":698,"children":699},{"style":191},[700],{"type":41,"value":701},"\u003C",{"type":29,"tag":178,"props":703,"children":705},{"style":704},"--shiki-default:#85E89D",[706],{"type":41,"value":707},"template",{"type":29,"tag":178,"props":709,"children":710},{"style":191},[711],{"type":41,"value":712},">\n",{"type":29,"tag":178,"props":714,"children":715},{"class":180,"line":208},[716,721,726],{"type":29,"tag":178,"props":717,"children":718},{"style":191},[719],{"type":41,"value":720},"  \u003C",{"type":29,"tag":178,"props":722,"children":723},{"style":704},[724],{"type":41,"value":725},"div",{"type":29,"tag":178,"props":727,"children":728},{"style":191},[729],{"type":41,"value":712},{"type":29,"tag":178,"props":731,"children":732},{"class":180,"line":218},[733],{"type":29,"tag":178,"props":734,"children":735},{"style":395},[736],{"type":41,"value":737},"    \u003C!-- 這裡面有個元素依賴了store的state切換顯示 -->\n",{"type":29,"tag":178,"props":739,"children":740},{"class":180,"line":240},[741],{"type":29,"tag":178,"props":742,"children":743},{"style":395},[744],{"type":41,"value":745},"    \u003C!-- TestHeader會出現Hydration node mismatch的問題 -->\n",{"type":29,"tag":178,"props":747,"children":748},{"class":180,"line":262},[749,754,759],{"type":29,"tag":178,"props":750,"children":751},{"style":191},[752],{"type":41,"value":753},"    \u003C",{"type":29,"tag":178,"props":755,"children":756},{"style":704},[757],{"type":41,"value":758},"TestHeader",{"type":29,"tag":178,"props":760,"children":761},{"style":191},[762],{"type":41,"value":763}," />\n",{"type":29,"tag":178,"props":765,"children":766},{"class":180,"line":270},[767],{"type":29,"tag":178,"props":768,"children":769},{"emptyLinePlaceholder":212},[770],{"type":41,"value":215},{"type":29,"tag":178,"props":772,"children":773},{"class":180,"line":316},[774],{"type":29,"tag":178,"props":775,"children":776},{"style":395},[777],{"type":41,"value":778},"    \u003C!-- 我在頁面元件中修改了store的state -->\n",{"type":29,"tag":178,"props":780,"children":781},{"class":180,"line":340},[782,786,791],{"type":29,"tag":178,"props":783,"children":784},{"style":191},[785],{"type":41,"value":753},{"type":29,"tag":178,"props":787,"children":788},{"style":704},[789],{"type":41,"value":790},"NuxtPage",{"type":29,"tag":178,"props":792,"children":793},{"style":191},[794],{"type":41,"value":763},{"type":29,"tag":178,"props":796,"children":797},{"class":180,"line":359},[798],{"type":29,"tag":178,"props":799,"children":800},{"emptyLinePlaceholder":212},[801],{"type":41,"value":215},{"type":29,"tag":178,"props":803,"children":804},{"class":180,"line":368},[805],{"type":29,"tag":178,"props":806,"children":807},{"style":395},[808],{"type":41,"value":809},"    \u003C!-- 放在NuxtPage後面的TestFooter不會出現同樣問題 -->\n",{"type":29,"tag":178,"props":811,"children":812},{"class":180,"line":377},[813,817,822],{"type":29,"tag":178,"props":814,"children":815},{"style":191},[816],{"type":41,"value":753},{"type":29,"tag":178,"props":818,"children":819},{"style":704},[820],{"type":41,"value":821},"TestFooter",{"type":29,"tag":178,"props":823,"children":824},{"style":191},[825],{"type":41,"value":763},{"type":29,"tag":178,"props":827,"children":828},{"class":180,"line":391},[829,834,838],{"type":29,"tag":178,"props":830,"children":831},{"style":191},[832],{"type":41,"value":833},"  \u003C/",{"type":29,"tag":178,"props":835,"children":836},{"style":704},[837],{"type":41,"value":725},{"type":29,"tag":178,"props":839,"children":840},{"style":191},[841],{"type":41,"value":712},{"type":29,"tag":178,"props":843,"children":844},{"class":180,"line":401},[845,850,854],{"type":29,"tag":178,"props":846,"children":847},{"style":191},[848],{"type":41,"value":849},"\u003C/",{"type":29,"tag":178,"props":851,"children":852},{"style":704},[853],{"type":41,"value":707},{"type":29,"tag":178,"props":855,"children":856},{"style":191},[857],{"type":41,"value":712},{"type":29,"tag":178,"props":859,"children":860},{"class":180,"line":410},[861],{"type":29,"tag":178,"props":862,"children":863},{"emptyLinePlaceholder":212},[864],{"type":41,"value":215},{"type":29,"tag":178,"props":866,"children":867},{"class":180,"line":419},[868,872,877,882],{"type":29,"tag":178,"props":869,"children":870},{"style":191},[871],{"type":41,"value":701},{"type":29,"tag":178,"props":873,"children":874},{"style":704},[875],{"type":41,"value":876},"script",{"type":29,"tag":178,"props":878,"children":879},{"style":295},[880],{"type":41,"value":881}," setup",{"type":29,"tag":178,"props":883,"children":884},{"style":191},[885],{"type":41,"value":712},{"type":29,"tag":178,"props":887,"children":889},{"class":180,"line":888},16,[890,894,899,903],{"type":29,"tag":178,"props":891,"children":892},{"style":185},[893],{"type":41,"value":188},{"type":29,"tag":178,"props":895,"children":896},{"style":191},[897],{"type":41,"value":898}," TestHeader ",{"type":29,"tag":178,"props":900,"children":901},{"style":185},[902],{"type":41,"value":199},{"type":29,"tag":178,"props":904,"children":905},{"style":202},[906],{"type":41,"value":907}," '~/components/test-header.vue'\n",{"type":29,"tag":178,"props":909,"children":911},{"class":180,"line":910},17,[912,916,921,925],{"type":29,"tag":178,"props":913,"children":914},{"style":185},[915],{"type":41,"value":188},{"type":29,"tag":178,"props":917,"children":918},{"style":191},[919],{"type":41,"value":920}," TestFooter ",{"type":29,"tag":178,"props":922,"children":923},{"style":185},[924],{"type":41,"value":199},{"type":29,"tag":178,"props":926,"children":927},{"style":202},[928],{"type":41,"value":929}," '~/components/test-footer.vue'\n",{"type":29,"tag":178,"props":931,"children":933},{"class":180,"line":932},18,[934,938,942],{"type":29,"tag":178,"props":935,"children":936},{"style":191},[937],{"type":41,"value":849},{"type":29,"tag":178,"props":939,"children":940},{"style":704},[941],{"type":41,"value":876},{"type":29,"tag":178,"props":943,"children":944},{"style":191},[945],{"type":41,"value":712},{"type":29,"tag":30,"props":947,"children":948},{},[949,951,958],{"type":41,"value":950},"幾經測試之後，發現好像是元件解析順序的問題，也在 Nuxt Github 的 Discussions 裡面有發現",{"type":29,"tag":34,"props":952,"children":955},{"href":953,"rel":954},"https://github.com/nuxt/nuxt/discussions/17011",[38],[956],{"type":41,"value":957},"相關討論",{"type":41,"value":165},{"type":29,"tag":960,"props":961,"children":962},"blockquote",{},[963],{"type":29,"tag":30,"props":964,"children":965},{},[966],{"type":41,"value":967},"This is a common SSR gotcha. The issue is that on SSR, Vue renders the HTML from top to bottom, outside to inside. And if you only fetch some data as you are rendering the 'inner' part of the page, it doesn't rerender the layout at the top of the page. (On client-side it's fine as can be reactive.) So if you have a common piece you rely on for rendering your page, make sure to fetch it in the layout, a plugin, or a middleware - somewhere outside of the rendering process.",{"type":29,"tag":30,"props":969,"children":970},{},[971],{"type":41,"value":972},"沒錯，如 Nuxt 團隊的領導人所說：這是一個「common SSR gotcha」（常見的 SSR 問題），無法被解決，只能在開發時自己小心了（是說 Nuxt 2 沒這問題呀……還是只是沒 WARN 而已？）。",{"type":29,"tag":30,"props":974,"children":975},{},[976,978,984],{"type":41,"value":977},"目前因為是 SEO 不敏感的區塊所以還好，解法是直接先把那一個區塊用",{"type":29,"tag":46,"props":979,"children":981},{"className":980},[],[982],{"type":41,"value":983},"\u003CClientOnly>",{"type":41,"value":985},"包起來，只是未來若遇到這樣的情境，而區塊剛好是 SEO 敏感的區塊……可能就要想想怎麼做了。",{"type":29,"tag":77,"props":987,"children":988},{},[],{"type":29,"tag":81,"props":990,"children":992},{"id":991},"後記",[993],{"type":41,"value":991},{"type":29,"tag":30,"props":995,"children":996},{},[997],{"type":41,"value":998},"大概是這樣，只能說 Nuxt 2 升 3 的坑其實不少啊……（顯示為精疲力盡）。",{"type":29,"tag":1000,"props":1001,"children":1002},"style",{},[1003],{"type":41,"value":1004},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":208,"depth":208,"links":1006},[1007,1008,1009,1010],{"id":83,"depth":208,"text":83},{"id":121,"depth":208,"text":124},{"id":639,"depth":208,"text":642},{"id":991,"depth":208,"text":991},"markdown","content:articles:2024:nuxt2_to_nuxt3_blog_6_modules_pinia.md","content","articles/2024/nuxt2_to_nuxt3_blog_6_modules_pinia.md","articles/2024/nuxt2_to_nuxt3_blog_6_modules_pinia","md","2024-01-24T07:26:04.000Z","nuxt2_to_nuxt3_blog_6_modules_pinia",[1020,1035,1044],{"title":1021,"description":1022,"img":10,"tags":1023,"readingTime":1028,"createdAt":1033,"updatedAt":1017,"slug":1034},"部落格Nuxt 2升級Nuxt 3（一）：bootstrapVue置換成自製的bootrap5元件","如之前規劃，部落格升級 Nuxt3 的第一步是先把 bootstrapVue 抽換成自己實做的 bootstrap5。這篇是紀錄過程中覺得特別困難或是需要研究的部份。",[12,13,14,15,16,1024,1025,1026,1027],"bootstrapVue","bootstrap 4","bootstrap 5","bootstrap",{"text":1029,"minutes":1030,"time":1031,"words":1032},"4 min read",3.53,211800,706,"2024-01-23T05:33:23.000Z","nuxt2_to_nuxt3_blog_1_ui",{"title":1036,"description":1037,"img":10,"tags":1038,"readingTime":1039,"createdAt":1033,"updatedAt":1017,"slug":1043},"部落格Nuxt 2升級Nuxt 3：前言","從去年年初開始建置的這個部落格網站，邊寫文章的同時陸陸續續補上功能後，大概到上個月才終於像是有個部落格的樣子。但由於 Nuxt2 即將在 2024/06/30 停止官方支援，而作為基底的 Vue2 更是在 2023/12/31 已停止官方支援，所以……想說要做的新功能可能先放著，先把部落格從 Nuxt2 升級到 Nuxt3 比較好。",[12,13,14,15,16],{"text":21,"minutes":1040,"time":1041,"words":1042},4.28,256800,856,"nuxt2_to_nuxt3_blog_0_intro",{"title":1045,"description":1046,"img":10,"tags":1047,"readingTime":1049,"createdAt":1017,"updatedAt":1017,"slug":1054},"部落格Nuxt 2升級Nuxt 3（五）：Sitemap模組升級","原本使用的 Sitemap 模組 @nuxtjs/sitemap 有支援 Nuxt 3 的版本，所以升級起來不如前面幾篇困難，主要就是修改一下設定值而已。",[12,13,14,15,16,1048],"sitemap",{"text":1050,"minutes":1051,"time":1052,"words":1053},"2 min read",1.72,103200,344,"nuxt2_to_nuxt3_blog_5_modules_sitemap",1733124062852]