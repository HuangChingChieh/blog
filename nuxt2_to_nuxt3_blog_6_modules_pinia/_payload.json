[{"data":1,"prerenderedAt":1029},["ShallowReactive",2],{"nuxt2_to_nuxt3_blog_6_modules_pinia":3,"Related_nuxt2_to_nuxt3_blog_6_modules_pinia":993},{"title":4,"description":5,"img":6,"readingTime":7,"createdAt":12,"updatedAt":12,"slug":13,"tags":14,"category":22,"body":23},"部落格Nuxt 2升級Nuxt 3（六）：Vuex → Pinia","Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供nuxtServerInit方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。","924/Ia2nWi.png",{"text":8,"minutes":9,"time":10,"words":11},"5 min read",4.19,251400,838,"2024-01-24T07:26:04.000Z","nuxt2_to_nuxt3_blog_6_modules_pinia",[15,16,17,18,19,20,21],"blog","nuxt","vue","nuxt2","nuxt3","vuex","pinia","frontend",{"type":24,"children":25,"toc":987},"root",[26,52,57,61,67,72,97,100,106,126,147,408,421,611,616,619,625,630,667,928,941,950,955,968,971,976,981],{"type":27,"tag":28,"props":29,"children":30},"element","p",{},[31,41,43,50],{"type":27,"tag":32,"props":33,"children":37},"a",{"href":34,"rel":35},"https://nuxt.com/docs/getting-started/state-management#using-third-party-libraries",[36],"nofollow",[38],{"type":39,"value":40},"text","Nuxt 3 的狀態管理套件從 Nuxt 2 的 Vuex 改成了 Pinia",{"type":39,"value":42},"，兩者差異不算大，部落格用到的功能也不多。其中比較要注意的就是 Nuxt 3 不再提供",{"type":27,"tag":44,"props":45,"children":47},"code",{"className":46},[],[48],{"type":39,"value":49},"nuxtServerInit",{"type":39,"value":51},"方法，若需要在 server 端初始化一些資料的話，就要透過其他作法來完成。",{"type":27,"tag":28,"props":53,"children":54},{},[55],{"type":39,"value":56},"本來以為升級起來不會太困難，但踩了個小坑……。",{"type":27,"tag":58,"props":59,"children":60},"hr",{},[],{"type":27,"tag":62,"props":63,"children":65},"h2",{"id":64},"寫法差異",[66],{"type":39,"value":64},{"type":27,"tag":28,"props":68,"children":69},{},[70],{"type":39,"value":71},"這部份因為滿容易的，這邊僅列出官方文章做個參考紀錄：",{"type":27,"tag":73,"props":74,"children":75},"ul",{},[76,87],{"type":27,"tag":77,"props":78,"children":79},"li",{},[80],{"type":27,"tag":32,"props":81,"children":84},{"href":82,"rel":83},"https://pinia.vuejs.org/ssr/nuxt.html",[36],[85],{"type":39,"value":86},"Nuxt.js 整合指引",{"type":27,"tag":77,"props":88,"children":89},{},[90],{"type":27,"tag":32,"props":91,"children":94},{"href":92,"rel":93},"https://pinia.vuejs.org/cookbook/migration-vuex.html",[36],[95],{"type":39,"value":96},"Migrating from Vuex ≤ 4",{"type":27,"tag":58,"props":98,"children":99},{},[],{"type":27,"tag":62,"props":101,"children":103},{"id":102},"實作-nuxtserverinit",[104],{"type":39,"value":105},"實作 nuxtServerInit",{"type":27,"tag":28,"props":107,"children":108},{},[109,111,116,118,124],{"type":39,"value":110},"之前在 Nuxt 2 中使用",{"type":27,"tag":44,"props":112,"children":114},{"className":113},[],[115],{"type":39,"value":49},{"type":39,"value":117},"，是因為我會在此處先處理並紀錄一些 metada（例如各分類的文章數量與頁數）以供元件使用，Nuxt 3 並無提供此方式，參考網路上文章之後可以透過「只在 server 端執行的",{"type":27,"tag":44,"props":119,"children":121},{"className":120},[],[122],{"type":39,"value":123},"plugins",{"type":39,"value":125},"」來完成：",{"type":27,"tag":28,"props":127,"children":128},{},[129,131,137,139,145],{"type":39,"value":130},"首先在主要的",{"type":27,"tag":44,"props":132,"children":134},{"className":133},[],[135],{"type":39,"value":136},"store",{"type":39,"value":138},"下新增",{"type":27,"tag":44,"props":140,"children":142},{"className":141},[],[143],{"type":39,"value":144},"index.js",{"type":39,"value":146},"：",{"type":27,"tag":148,"props":149,"children":155},"pre",{"className":150,"code":151,"filename":152,"language":153,"meta":154,"style":154},"language-js shiki shiki-themes github-dark","import { defineStore } from 'pinia'\n\nimport { getCategories, setPageCount } from '~/utils/getCategories'\nimport getTags from '~/utils/getTags'\n\nexport const useMainStore = defineStore('main', {\n  state: () => ({\n    someState: '',\n  }),\n  actions: {\n    nuxtServerInit() {\n      // 這邊做原本nuxtServerInit要做的事\n    },\n  },\n})\n","store/index.js","js","",[156],{"type":27,"tag":44,"props":157,"children":158},{"__ignoreMap":154},[159,188,198,220,242,250,296,320,339,348,357,371,381,390,399],{"type":27,"tag":160,"props":161,"children":164},"span",{"class":162,"line":163},"line",1,[165,171,177,182],{"type":27,"tag":160,"props":166,"children":168},{"style":167},"--shiki-default:#F97583",[169],{"type":39,"value":170},"import",{"type":27,"tag":160,"props":172,"children":174},{"style":173},"--shiki-default:#E1E4E8",[175],{"type":39,"value":176}," { defineStore } ",{"type":27,"tag":160,"props":178,"children":179},{"style":167},[180],{"type":39,"value":181},"from",{"type":27,"tag":160,"props":183,"children":185},{"style":184},"--shiki-default:#9ECBFF",[186],{"type":39,"value":187}," 'pinia'\n",{"type":27,"tag":160,"props":189,"children":191},{"class":162,"line":190},2,[192],{"type":27,"tag":160,"props":193,"children":195},{"emptyLinePlaceholder":194},true,[196],{"type":39,"value":197},"\n",{"type":27,"tag":160,"props":199,"children":201},{"class":162,"line":200},3,[202,206,211,215],{"type":27,"tag":160,"props":203,"children":204},{"style":167},[205],{"type":39,"value":170},{"type":27,"tag":160,"props":207,"children":208},{"style":173},[209],{"type":39,"value":210}," { getCategories, setPageCount } ",{"type":27,"tag":160,"props":212,"children":213},{"style":167},[214],{"type":39,"value":181},{"type":27,"tag":160,"props":216,"children":217},{"style":184},[218],{"type":39,"value":219}," '~/utils/getCategories'\n",{"type":27,"tag":160,"props":221,"children":223},{"class":162,"line":222},4,[224,228,233,237],{"type":27,"tag":160,"props":225,"children":226},{"style":167},[227],{"type":39,"value":170},{"type":27,"tag":160,"props":229,"children":230},{"style":173},[231],{"type":39,"value":232}," getTags ",{"type":27,"tag":160,"props":234,"children":235},{"style":167},[236],{"type":39,"value":181},{"type":27,"tag":160,"props":238,"children":239},{"style":184},[240],{"type":39,"value":241}," '~/utils/getTags'\n",{"type":27,"tag":160,"props":243,"children":245},{"class":162,"line":244},5,[246],{"type":27,"tag":160,"props":247,"children":248},{"emptyLinePlaceholder":194},[249],{"type":39,"value":197},{"type":27,"tag":160,"props":251,"children":253},{"class":162,"line":252},6,[254,259,264,270,275,281,286,291],{"type":27,"tag":160,"props":255,"children":256},{"style":167},[257],{"type":39,"value":258},"export",{"type":27,"tag":160,"props":260,"children":261},{"style":167},[262],{"type":39,"value":263}," const",{"type":27,"tag":160,"props":265,"children":267},{"style":266},"--shiki-default:#79B8FF",[268],{"type":39,"value":269}," useMainStore",{"type":27,"tag":160,"props":271,"children":272},{"style":167},[273],{"type":39,"value":274}," =",{"type":27,"tag":160,"props":276,"children":278},{"style":277},"--shiki-default:#B392F0",[279],{"type":39,"value":280}," defineStore",{"type":27,"tag":160,"props":282,"children":283},{"style":173},[284],{"type":39,"value":285},"(",{"type":27,"tag":160,"props":287,"children":288},{"style":184},[289],{"type":39,"value":290},"'main'",{"type":27,"tag":160,"props":292,"children":293},{"style":173},[294],{"type":39,"value":295},", {\n",{"type":27,"tag":160,"props":297,"children":299},{"class":162,"line":298},7,[300,305,310,315],{"type":27,"tag":160,"props":301,"children":302},{"style":277},[303],{"type":39,"value":304},"  state",{"type":27,"tag":160,"props":306,"children":307},{"style":173},[308],{"type":39,"value":309},": () ",{"type":27,"tag":160,"props":311,"children":312},{"style":167},[313],{"type":39,"value":314},"=>",{"type":27,"tag":160,"props":316,"children":317},{"style":173},[318],{"type":39,"value":319}," ({\n",{"type":27,"tag":160,"props":321,"children":323},{"class":162,"line":322},8,[324,329,334],{"type":27,"tag":160,"props":325,"children":326},{"style":173},[327],{"type":39,"value":328},"    someState: ",{"type":27,"tag":160,"props":330,"children":331},{"style":184},[332],{"type":39,"value":333},"''",{"type":27,"tag":160,"props":335,"children":336},{"style":173},[337],{"type":39,"value":338},",\n",{"type":27,"tag":160,"props":340,"children":342},{"class":162,"line":341},9,[343],{"type":27,"tag":160,"props":344,"children":345},{"style":173},[346],{"type":39,"value":347},"  }),\n",{"type":27,"tag":160,"props":349,"children":351},{"class":162,"line":350},10,[352],{"type":27,"tag":160,"props":353,"children":354},{"style":173},[355],{"type":39,"value":356},"  actions: {\n",{"type":27,"tag":160,"props":358,"children":360},{"class":162,"line":359},11,[361,366],{"type":27,"tag":160,"props":362,"children":363},{"style":277},[364],{"type":39,"value":365},"    nuxtServerInit",{"type":27,"tag":160,"props":367,"children":368},{"style":173},[369],{"type":39,"value":370},"() {\n",{"type":27,"tag":160,"props":372,"children":374},{"class":162,"line":373},12,[375],{"type":27,"tag":160,"props":376,"children":378},{"style":377},"--shiki-default:#6A737D",[379],{"type":39,"value":380},"      // 這邊做原本nuxtServerInit要做的事\n",{"type":27,"tag":160,"props":382,"children":384},{"class":162,"line":383},13,[385],{"type":27,"tag":160,"props":386,"children":387},{"style":173},[388],{"type":39,"value":389},"    },\n",{"type":27,"tag":160,"props":391,"children":393},{"class":162,"line":392},14,[394],{"type":27,"tag":160,"props":395,"children":396},{"style":173},[397],{"type":39,"value":398},"  },\n",{"type":27,"tag":160,"props":400,"children":402},{"class":162,"line":401},15,[403],{"type":27,"tag":160,"props":404,"children":405},{"style":173},[406],{"type":39,"value":407},"})\n",{"type":27,"tag":28,"props":409,"children":410},{},[411,413,419],{"type":39,"value":412},"接著新增只在 server 端執行的 plugin，可以在命名後加上後綴字",{"type":27,"tag":44,"props":414,"children":416},{"className":415},[],[417],{"type":39,"value":418},".server.js",{"type":39,"value":420},"來標明：",{"type":27,"tag":148,"props":422,"children":425},{"className":150,"code":423,"filename":424,"language":153,"meta":154,"style":154},"import { useMainStore } from '~/store'\n\nexport default defineNuxtPlugin(async ({ $pinia }) => {\n  const someAsyncData = await someAsyncFn()\n\n  // 這邊引用前段宣告的store，記得要把context的$pinia傳進去。\n  // 可參考：https://pinia.vuejs.org/ssr/nuxt.html#Awaiting-for-actions-in-pages\n  const mainStore = useMainStore($pinia)\n  mainStore.nuxtServerInit()\n})\n","plugins/init.server.js",[426],{"type":27,"tag":44,"props":427,"children":428},{"__ignoreMap":154},[429,450,457,508,540,547,555,563,588,604],{"type":27,"tag":160,"props":430,"children":431},{"class":162,"line":163},[432,436,441,445],{"type":27,"tag":160,"props":433,"children":434},{"style":167},[435],{"type":39,"value":170},{"type":27,"tag":160,"props":437,"children":438},{"style":173},[439],{"type":39,"value":440}," { useMainStore } ",{"type":27,"tag":160,"props":442,"children":443},{"style":167},[444],{"type":39,"value":181},{"type":27,"tag":160,"props":446,"children":447},{"style":184},[448],{"type":39,"value":449}," '~/store'\n",{"type":27,"tag":160,"props":451,"children":452},{"class":162,"line":190},[453],{"type":27,"tag":160,"props":454,"children":455},{"emptyLinePlaceholder":194},[456],{"type":39,"value":197},{"type":27,"tag":160,"props":458,"children":459},{"class":162,"line":200},[460,464,469,474,478,483,488,494,499,503],{"type":27,"tag":160,"props":461,"children":462},{"style":167},[463],{"type":39,"value":258},{"type":27,"tag":160,"props":465,"children":466},{"style":167},[467],{"type":39,"value":468}," default",{"type":27,"tag":160,"props":470,"children":471},{"style":277},[472],{"type":39,"value":473}," defineNuxtPlugin",{"type":27,"tag":160,"props":475,"children":476},{"style":173},[477],{"type":39,"value":285},{"type":27,"tag":160,"props":479,"children":480},{"style":167},[481],{"type":39,"value":482},"async",{"type":27,"tag":160,"props":484,"children":485},{"style":173},[486],{"type":39,"value":487}," ({ ",{"type":27,"tag":160,"props":489,"children":491},{"style":490},"--shiki-default:#FFAB70",[492],{"type":39,"value":493},"$pinia",{"type":27,"tag":160,"props":495,"children":496},{"style":173},[497],{"type":39,"value":498}," }) ",{"type":27,"tag":160,"props":500,"children":501},{"style":167},[502],{"type":39,"value":314},{"type":27,"tag":160,"props":504,"children":505},{"style":173},[506],{"type":39,"value":507}," {\n",{"type":27,"tag":160,"props":509,"children":510},{"class":162,"line":222},[511,516,521,525,530,535],{"type":27,"tag":160,"props":512,"children":513},{"style":167},[514],{"type":39,"value":515},"  const",{"type":27,"tag":160,"props":517,"children":518},{"style":266},[519],{"type":39,"value":520}," someAsyncData",{"type":27,"tag":160,"props":522,"children":523},{"style":167},[524],{"type":39,"value":274},{"type":27,"tag":160,"props":526,"children":527},{"style":167},[528],{"type":39,"value":529}," await",{"type":27,"tag":160,"props":531,"children":532},{"style":277},[533],{"type":39,"value":534}," someAsyncFn",{"type":27,"tag":160,"props":536,"children":537},{"style":173},[538],{"type":39,"value":539},"()\n",{"type":27,"tag":160,"props":541,"children":542},{"class":162,"line":244},[543],{"type":27,"tag":160,"props":544,"children":545},{"emptyLinePlaceholder":194},[546],{"type":39,"value":197},{"type":27,"tag":160,"props":548,"children":549},{"class":162,"line":252},[550],{"type":27,"tag":160,"props":551,"children":552},{"style":377},[553],{"type":39,"value":554},"  // 這邊引用前段宣告的store，記得要把context的$pinia傳進去。\n",{"type":27,"tag":160,"props":556,"children":557},{"class":162,"line":298},[558],{"type":27,"tag":160,"props":559,"children":560},{"style":377},[561],{"type":39,"value":562},"  // 可參考：https://pinia.vuejs.org/ssr/nuxt.html#Awaiting-for-actions-in-pages\n",{"type":27,"tag":160,"props":564,"children":565},{"class":162,"line":322},[566,570,575,579,583],{"type":27,"tag":160,"props":567,"children":568},{"style":167},[569],{"type":39,"value":515},{"type":27,"tag":160,"props":571,"children":572},{"style":266},[573],{"type":39,"value":574}," mainStore",{"type":27,"tag":160,"props":576,"children":577},{"style":167},[578],{"type":39,"value":274},{"type":27,"tag":160,"props":580,"children":581},{"style":277},[582],{"type":39,"value":269},{"type":27,"tag":160,"props":584,"children":585},{"style":173},[586],{"type":39,"value":587},"($pinia)\n",{"type":27,"tag":160,"props":589,"children":590},{"class":162,"line":341},[591,596,600],{"type":27,"tag":160,"props":592,"children":593},{"style":173},[594],{"type":39,"value":595},"  mainStore.",{"type":27,"tag":160,"props":597,"children":598},{"style":277},[599],{"type":39,"value":49},{"type":27,"tag":160,"props":601,"children":602},{"style":173},[603],{"type":39,"value":539},{"type":27,"tag":160,"props":605,"children":606},{"class":162,"line":350},[607],{"type":27,"tag":160,"props":608,"children":609},{"style":173},[610],{"type":39,"value":407},{"type":27,"tag":28,"props":612,"children":613},{},[614],{"type":39,"value":615},"這樣就完成囉。",{"type":27,"tag":58,"props":617,"children":618},{},[],{"type":27,"tag":62,"props":620,"children":622},{"id":621},"在-ssr-端修改-state-的眉角",[623],{"type":39,"value":624},"在 SSR 端修改 state 的眉角",{"type":27,"tag":28,"props":626,"children":627},{},[628],{"type":39,"value":629},"這中間踩了一個坑，本來以為是 Bug 但其實不是。",{"type":27,"tag":28,"props":631,"children":632},{},[633,635,641,643,649,651,657,659,665],{"type":39,"value":634},"總之是這樣的，我在頁面中去修改了某個在 store 中的屬性，而在 layout 中順序比",{"type":27,"tag":44,"props":636,"children":638},{"className":637},[],[639],{"type":39,"value":640},"\u003Cslot />",{"type":39,"value":642},"（也就是",{"type":27,"tag":44,"props":644,"children":646},{"className":645},[],[647],{"type":39,"value":648},"\u003CNuxtPage />",{"type":39,"value":650},"的置入點）前面的元件，若依賴了這個屬性去做",{"type":27,"tag":44,"props":652,"children":654},{"className":653},[],[655],{"type":39,"value":656},"v-if",{"type":39,"value":658},"的顯示，則會在直接進入頁面時出現",{"type":27,"tag":44,"props":660,"children":662},{"className":661},[],[663],{"type":39,"value":664},"Hydration node mismatch",{"type":39,"value":666},"的警告，暗示我 server 端與 client 端的元件長得不一樣（也就是資料不一致）。",{"type":27,"tag":148,"props":668,"children":672},{"className":669,"code":670,"filename":671,"language":17,"meta":154,"style":154},"language-vue shiki shiki-themes github-dark","\u003Ctemplate>\n  \u003Cdiv>\n    \u003C!-- 這裡面有個元素依賴了store的state切換顯示 -->\n    \u003C!-- TestHeader會出現Hydration node mismatch的問題 -->\n    \u003CTestHeader />\n\n    \u003C!-- 我在頁面元件中修改了store的state -->\n    \u003CNuxtPage />\n\n    \u003C!-- 放在NuxtPage後面的TestFooter不會出現同樣問題 -->\n    \u003CTestFooter />\n  \u003C/div>\n\u003C/template>\n\n\u003Cscript setup>\nimport TestHeader from '~/components/test-header.vue'\nimport TestFooter from '~/components/test-footer.vue'\n\u003C/script>\n","layouts/default.vue",[673],{"type":27,"tag":44,"props":674,"children":675},{"__ignoreMap":154},[676,695,712,720,728,746,753,761,777,784,792,808,824,840,847,868,890,912],{"type":27,"tag":160,"props":677,"children":678},{"class":162,"line":163},[679,684,690],{"type":27,"tag":160,"props":680,"children":681},{"style":173},[682],{"type":39,"value":683},"\u003C",{"type":27,"tag":160,"props":685,"children":687},{"style":686},"--shiki-default:#85E89D",[688],{"type":39,"value":689},"template",{"type":27,"tag":160,"props":691,"children":692},{"style":173},[693],{"type":39,"value":694},">\n",{"type":27,"tag":160,"props":696,"children":697},{"class":162,"line":190},[698,703,708],{"type":27,"tag":160,"props":699,"children":700},{"style":173},[701],{"type":39,"value":702},"  \u003C",{"type":27,"tag":160,"props":704,"children":705},{"style":686},[706],{"type":39,"value":707},"div",{"type":27,"tag":160,"props":709,"children":710},{"style":173},[711],{"type":39,"value":694},{"type":27,"tag":160,"props":713,"children":714},{"class":162,"line":200},[715],{"type":27,"tag":160,"props":716,"children":717},{"style":377},[718],{"type":39,"value":719},"    \u003C!-- 這裡面有個元素依賴了store的state切換顯示 -->\n",{"type":27,"tag":160,"props":721,"children":722},{"class":162,"line":222},[723],{"type":27,"tag":160,"props":724,"children":725},{"style":377},[726],{"type":39,"value":727},"    \u003C!-- TestHeader會出現Hydration node mismatch的問題 -->\n",{"type":27,"tag":160,"props":729,"children":730},{"class":162,"line":244},[731,736,741],{"type":27,"tag":160,"props":732,"children":733},{"style":173},[734],{"type":39,"value":735},"    \u003C",{"type":27,"tag":160,"props":737,"children":738},{"style":686},[739],{"type":39,"value":740},"TestHeader",{"type":27,"tag":160,"props":742,"children":743},{"style":173},[744],{"type":39,"value":745}," />\n",{"type":27,"tag":160,"props":747,"children":748},{"class":162,"line":252},[749],{"type":27,"tag":160,"props":750,"children":751},{"emptyLinePlaceholder":194},[752],{"type":39,"value":197},{"type":27,"tag":160,"props":754,"children":755},{"class":162,"line":298},[756],{"type":27,"tag":160,"props":757,"children":758},{"style":377},[759],{"type":39,"value":760},"    \u003C!-- 我在頁面元件中修改了store的state -->\n",{"type":27,"tag":160,"props":762,"children":763},{"class":162,"line":322},[764,768,773],{"type":27,"tag":160,"props":765,"children":766},{"style":173},[767],{"type":39,"value":735},{"type":27,"tag":160,"props":769,"children":770},{"style":686},[771],{"type":39,"value":772},"NuxtPage",{"type":27,"tag":160,"props":774,"children":775},{"style":173},[776],{"type":39,"value":745},{"type":27,"tag":160,"props":778,"children":779},{"class":162,"line":341},[780],{"type":27,"tag":160,"props":781,"children":782},{"emptyLinePlaceholder":194},[783],{"type":39,"value":197},{"type":27,"tag":160,"props":785,"children":786},{"class":162,"line":350},[787],{"type":27,"tag":160,"props":788,"children":789},{"style":377},[790],{"type":39,"value":791},"    \u003C!-- 放在NuxtPage後面的TestFooter不會出現同樣問題 -->\n",{"type":27,"tag":160,"props":793,"children":794},{"class":162,"line":359},[795,799,804],{"type":27,"tag":160,"props":796,"children":797},{"style":173},[798],{"type":39,"value":735},{"type":27,"tag":160,"props":800,"children":801},{"style":686},[802],{"type":39,"value":803},"TestFooter",{"type":27,"tag":160,"props":805,"children":806},{"style":173},[807],{"type":39,"value":745},{"type":27,"tag":160,"props":809,"children":810},{"class":162,"line":373},[811,816,820],{"type":27,"tag":160,"props":812,"children":813},{"style":173},[814],{"type":39,"value":815},"  \u003C/",{"type":27,"tag":160,"props":817,"children":818},{"style":686},[819],{"type":39,"value":707},{"type":27,"tag":160,"props":821,"children":822},{"style":173},[823],{"type":39,"value":694},{"type":27,"tag":160,"props":825,"children":826},{"class":162,"line":383},[827,832,836],{"type":27,"tag":160,"props":828,"children":829},{"style":173},[830],{"type":39,"value":831},"\u003C/",{"type":27,"tag":160,"props":833,"children":834},{"style":686},[835],{"type":39,"value":689},{"type":27,"tag":160,"props":837,"children":838},{"style":173},[839],{"type":39,"value":694},{"type":27,"tag":160,"props":841,"children":842},{"class":162,"line":392},[843],{"type":27,"tag":160,"props":844,"children":845},{"emptyLinePlaceholder":194},[846],{"type":39,"value":197},{"type":27,"tag":160,"props":848,"children":849},{"class":162,"line":401},[850,854,859,864],{"type":27,"tag":160,"props":851,"children":852},{"style":173},[853],{"type":39,"value":683},{"type":27,"tag":160,"props":855,"children":856},{"style":686},[857],{"type":39,"value":858},"script",{"type":27,"tag":160,"props":860,"children":861},{"style":277},[862],{"type":39,"value":863}," setup",{"type":27,"tag":160,"props":865,"children":866},{"style":173},[867],{"type":39,"value":694},{"type":27,"tag":160,"props":869,"children":871},{"class":162,"line":870},16,[872,876,881,885],{"type":27,"tag":160,"props":873,"children":874},{"style":167},[875],{"type":39,"value":170},{"type":27,"tag":160,"props":877,"children":878},{"style":173},[879],{"type":39,"value":880}," TestHeader ",{"type":27,"tag":160,"props":882,"children":883},{"style":167},[884],{"type":39,"value":181},{"type":27,"tag":160,"props":886,"children":887},{"style":184},[888],{"type":39,"value":889}," '~/components/test-header.vue'\n",{"type":27,"tag":160,"props":891,"children":893},{"class":162,"line":892},17,[894,898,903,907],{"type":27,"tag":160,"props":895,"children":896},{"style":167},[897],{"type":39,"value":170},{"type":27,"tag":160,"props":899,"children":900},{"style":173},[901],{"type":39,"value":902}," TestFooter ",{"type":27,"tag":160,"props":904,"children":905},{"style":167},[906],{"type":39,"value":181},{"type":27,"tag":160,"props":908,"children":909},{"style":184},[910],{"type":39,"value":911}," '~/components/test-footer.vue'\n",{"type":27,"tag":160,"props":913,"children":915},{"class":162,"line":914},18,[916,920,924],{"type":27,"tag":160,"props":917,"children":918},{"style":173},[919],{"type":39,"value":831},{"type":27,"tag":160,"props":921,"children":922},{"style":686},[923],{"type":39,"value":858},{"type":27,"tag":160,"props":925,"children":926},{"style":173},[927],{"type":39,"value":694},{"type":27,"tag":28,"props":929,"children":930},{},[931,933,940],{"type":39,"value":932},"幾經測試之後，發現好像是元件解析順序的問題，也在 Nuxt Github 的 Discussions 裡面有發現",{"type":27,"tag":32,"props":934,"children":937},{"href":935,"rel":936},"https://github.com/nuxt/nuxt/discussions/17011",[36],[938],{"type":39,"value":939},"相關討論",{"type":39,"value":146},{"type":27,"tag":942,"props":943,"children":944},"blockquote",{},[945],{"type":27,"tag":28,"props":946,"children":947},{},[948],{"type":39,"value":949},"This is a common SSR gotcha. The issue is that on SSR, Vue renders the HTML from top to bottom, outside to inside. And if you only fetch some data as you are rendering the 'inner' part of the page, it doesn't rerender the layout at the top of the page. (On client-side it's fine as can be reactive.) So if you have a common piece you rely on for rendering your page, make sure to fetch it in the layout, a plugin, or a middleware - somewhere outside of the rendering process.",{"type":27,"tag":28,"props":951,"children":952},{},[953],{"type":39,"value":954},"沒錯，如 Nuxt 團隊的領導人所說：這是一個「common SSR gotcha」（常見的 SSR 問題），無法被解決，只能在開發時自己小心了（是說 Nuxt 2 沒這問題呀……還是只是沒 WARN 而已？）。",{"type":27,"tag":28,"props":956,"children":957},{},[958,960,966],{"type":39,"value":959},"目前因為是 SEO 不敏感的區塊所以還好，解法是直接先把那一個區塊用",{"type":27,"tag":44,"props":961,"children":963},{"className":962},[],[964],{"type":39,"value":965},"\u003CClientOnly>",{"type":39,"value":967},"包起來，只是未來若遇到這樣的情境，而區塊剛好是 SEO 敏感的區塊……可能就要想想怎麼做了。",{"type":27,"tag":58,"props":969,"children":970},{},[],{"type":27,"tag":62,"props":972,"children":974},{"id":973},"後記",[975],{"type":39,"value":973},{"type":27,"tag":28,"props":977,"children":978},{},[979],{"type":39,"value":980},"大概是這樣，只能說 Nuxt 2 升 3 的坑其實不少啊……（顯示為精疲力盡）。",{"type":27,"tag":982,"props":983,"children":984},"style",{},[985],{"type":39,"value":986},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":154,"searchDepth":190,"depth":190,"links":988},[989,990,991,992],{"id":64,"depth":190,"text":64},{"id":102,"depth":190,"text":105},{"id":621,"depth":190,"text":624},{"id":973,"depth":190,"text":973},[994,1009,1018],{"title":995,"description":996,"img":6,"tags":997,"readingTime":1002,"createdAt":1007,"updatedAt":12,"slug":1008},"部落格Nuxt 2升級Nuxt 3（一）：bootstrapVue置換成自製的bootrap5元件","如之前規劃，部落格升級 Nuxt3 的第一步是先把 bootstrapVue 抽換成自己實做的 bootstrap5。這篇是紀錄過程中覺得特別困難或是需要研究的部份。",[15,16,17,18,19,998,999,1000,1001],"bootstrapVue","bootstrap 4","bootstrap 5","bootstrap",{"text":1003,"minutes":1004,"time":1005,"words":1006},"4 min read",3.53,211800,706,"2024-01-23T05:33:23.000Z","nuxt2_to_nuxt3_blog_1_ui",{"title":1010,"description":1011,"img":6,"tags":1012,"readingTime":1013,"createdAt":1007,"updatedAt":12,"slug":1017},"部落格Nuxt 2升級Nuxt 3：前言","從去年年初開始建置的這個部落格網站，邊寫文章的同時陸陸續續補上功能後，大概到上個月才終於像是有個部落格的樣子。但由於 Nuxt2 即將在 2024/06/30 停止官方支援，而作為基底的 Vue2 更是在 2023/12/31 已停止官方支援，所以……想說要做的新功能可能先放著，先把部落格從 Nuxt2 升級到 Nuxt3 比較好。",[15,16,17,18,19],{"text":8,"minutes":1014,"time":1015,"words":1016},4.28,256800,856,"nuxt2_to_nuxt3_blog_0_intro",{"title":1019,"description":1020,"img":6,"tags":1021,"readingTime":1023,"createdAt":12,"updatedAt":12,"slug":1028},"部落格Nuxt 2升級Nuxt 3（五）：Sitemap模組升級","原本使用的 Sitemap 模組 @nuxtjs/sitemap 有支援 Nuxt 3 的版本，所以升級起來不如前面幾篇困難，主要就是修改一下設定值而已。",[15,16,17,18,19,1022],"sitemap",{"text":1024,"minutes":1025,"time":1026,"words":1027},"2 min read",1.72,103200,344,"nuxt2_to_nuxt3_blog_5_modules_sitemap",1742204196469]