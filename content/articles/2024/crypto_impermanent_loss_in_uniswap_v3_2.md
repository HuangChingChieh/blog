---
title: Uniswap v3中的無常損失(2)：回顧與研究方法
img: 922/6v2E92.jpg
tags: [DeFi, 投資, 流動性挖礦, 加密貨幣, uniswap v3, uniswap]
category: life
---

此系列文章翻譯自 Topaze Blue 和 Bancor Protocol 在 2021 年 11 月 17 日發布的一份報告：[《Impermanent Loss in Uniswap v3》](https://arxiv.org/pdf/2111.09192.pdf)。作者分別為：

- [Stefan Loesch](mailto:stefan@topaze.blue)
- [Nate Hindman](mailto:nate@bancor.network)
- [Nicholas Welch](mailto:nick@bancor.network)
- [Mark B. Richardson](mailto:mark@bancor.network)

<!--more-->

譯文中會穿插自己看不懂而上網查到的專有名詞解釋或是筆記，請斟酌服用。

---

## 自動做市商

在 2021 年 5 月，Uniswap 推出了他們的最新協議版本：Uniswap v3，強調了集中流動性的概念。集中流動性的概念本身並非全新的，但 Uniswap v3 將其推往了更深的層次。在 Uniswap v3 中，每個流動性池的交易區域被切分為特定的價格範圍，流動性提供者可以自由選擇他們希望其流動性活躍的價格範圍。因此，Uniswap v3 可以在提供相同流動性價值的情況下實現顯著更低的滑點，並且在假設交易量遵循滑點的合理假設下，還可以顯著提高流動性賺取的手續費。

然而經常被忽視的是：這些手續費並非無償。槓桿流動性不僅會放大回報，還會放大與這些回報相關的風險。在這種情況下，為了增加手續費收入，流動性提供者必須等價面臨增加的無常損失。此篇報告的目的便是深入探討這個主題，並分析 Uv3 上的流動性提供者所遭受的無常損失。

---

## 在傳統自動做市商中的無常損失

在我們深入分析無常損失之前，我們需要指出，這個術語非常不幸：所謂的「無常」損失通常並非「無常」，特別是對於暴漲的幣種（常見的說法是"to the moon"）。在自動做市商中提供流動性，一個本應增值 50 倍的投資只能增值 10 倍，雖然如果幣種恢復到其原始價值，這種無常損失將被逆轉，但對於可能是該幣種信徒的「不幸」流動性提供者來說，這並沒有多大幫助。

為了方便討論，我們在此將無常損失定義為：

> 無常損失是自動做市商中，已對應手續費調整的流動性倉位價值，與僅持有（HODL）價值之間的差異。

需要進行調整流動性倉位價值是因為自動做市商的倉位會需要支付礦工手續費以及賺取交易手續費，需要排除這些因素才能區分出無常損失。同時，我們在這個階段想指出，由於存在多個流動性交易導致對應的 HODL 價值不容易辨識，此定義在 Uv3 中變得更加複雜。

我們在先前的一篇論文中討論了無常損失以及其與選擇權定價的關係，我們建議讀者參考該論文以進行更深入的討論。在這裡，我們只想回顧一下主要結果。

傳統的自動做市商（也稱為常數乘積自動做市商）依賴於以下特徵曲線：

`𝑘 = 𝑚 ⋅ 𝑛`

其中，`𝑘`是流動性池的常數，`𝑛`和`𝑚`是流動性池的組成幣種，有各自的定價標準。例如，如果一個流動性池包含 2 ETH 和 2000 USD，則常數`𝑘`會是 `2 * 2000 = 4000`。自動做市商中的所有交易都必須維持流動性池常數保持不變；換句話說，忽略費用的影響，對於下列這些持有幣並要於自動做市商中交易的人來說是一樣的：

- 持有 2 ETH / 2000 USD
- 持有 1 ETH / 4000 USD
- 持有 8 ETH / 500 USD

值得一提的是，如果`𝑘`是常數，那麼任何函數`𝑓(𝑘)`也會是常數。人們通常更喜歡使用`𝑘 = √𝑚 ⋅ 𝑛`而不是上面的公式，但就自動做市商而言，這兩個公式是相同的。

就傳統的自動做市商而言，最重要的觀點可說是：

> 在完整套利的自動做市商中，兩個資產的總美元價值始終是相等的。

我們在上面的描述中使用了「美元價值」，當然，如果美元價值相等，那麼歐元、以太幣或任何其他單位的價值也是相等的。下列是與其相關的一個關鍵推論——也是無常損失的源頭：

> 自動做市商總是賣出表現較好的資產，並購買表現較差的資產。

很容易看出這導致了與僅持有資產時相比的損失：在一開始投入流動性池的資產價值是相等的，然而當表現較好的資產上漲時，流動性池會不斷將其賣出。也就是說，在漲勢中，流動性池並非持有而是賣掉表現較好的資產，意味著它不能再從後續的價格上漲中獲利。簡而言之，這就是無常損失的來源。

如果您熟悉選擇權定價，您可能會將此認為是一種正 Gamma 策略。在區間交易市場中，這種策略允許您通過低價買入（在資產表現不佳時買入）和高價賣出（在資產表現優異時賣出）來賺錢，因此您應該能夠在您的 Gamma 上賺取期權溢價 Theta。

然而，事實證明，在自動做市商中的情況並非如此，原因是自動做市商不是積極的交易者，而是依靠套利者。假設忽略手續費收入，標準的自動做市商向套利者提供的，是在交易之前和之後的流動性池價格的中間點（幾何平均值）執行交易的機會。

讓我們進一步研究以了解無常損失的本質：假設流動性池價格目前為 100，價格變動到 110。在這種情況下，池子提供的交易價格是`√100 × 110`約等於 104.8，為套利者留下了 5.2 的利潤。如果市場回落到 100，流動性池再次以 `√110 × 100` 約等於 104.8 的價格交易，但這次是往反方向。

換句話說：流動性池在相反的走勢中以 104.8 的價格交易了兩次，因此剛好回到了起點。這就是為什麼被冠上「無常」的原因——當市場回到初始價格時，它將消失。然而，池子流失了大量價值：當它可以用 110 的價格賣出時，它以 104.8 的價格賣出；當它可以用 100 的價格買入時，它以 104.8 的價格買入。總的來說，流動性池本可以從這波漲跌中獲得 10 的利潤，但（忽略手續費）它卻將這 10 支付給了套利者。

為了計算無常損失，最容易的方法是將注意力集中於流動性池中的一個資產上。例如，有一個 ETH/USDX 流動性池，我們將注意力放在 USDX 上。我們將 𝑥<sub>t</sub> 定義為兩個資產的**交換率**，即兩個價格之間的比率。對於 ETH/USDX 和以 USDX 為單位的情況（就是以 USDX 去表示 ETH 價格），我們也將其標準化為 𝑥<sub>0</sub> = 1。因此技術上而言，我們的 𝑥<sub>t</sub> 是價格比率的變化（若我們假設無誤的話）。在這種情況下，將 1 個單位的定價資產各投資到每個資產的僅持有（HODL）策略價值為：

`𝐻𝑂𝐷𝐿(𝑥) = 1 + 𝑥`

讓我們再次強調一下，這些數字是無量綱的，需要乘以初始投資組合的名義值來進行比例調整。根據已知結果，以上情況下自動做市商組合的價值為：

`𝐴𝑀𝑀(𝑥) = 2√𝑥`

從這些基礎上便可推導出無常損失為：

<article-img img="924/iLGg7A.png" aspect-ratio="auto"></article-img>

如上所述，這個數字是無量綱的——它只是應用於原始投資組合名義值的百分比。

<article-img img="923/f7ykHp.png" aspect-ratio="auto"></article-img>

無常損失在資產上漲時是沒有極限的，而在資產下跌時雖看似有極限，但這是我們選擇關注單一資產的結果。最容易理解的例子為：如果流動性池是 ETH/USD，而 ETH 增值 100 倍，那麼以 USD 計算，流動性池增值 10 倍，而僅持有資產時增值 50 倍（只有一半的資金是 ETH），因此無常損失是剛開始的 40 倍，極端來說，以 USD 計算的無常損失在 ETH 上漲時並沒有極限。然而，當 ETH 下跌時，我們頂多虧損掉剛開始投資的價值，因此，在 ETH 下跌方面的最大損失率，以 USD 計算時會是 100%。

但若反過來以 ETH 為單位，當 ETH 下跌趨近於 0 時是很大的損失。如果我們改以 ETH 為單位計算，那麼 ETH 下跌（即 USD 上漲）的狀況，在以 ETH 計算時的無常損失仍是沒有極限的。
