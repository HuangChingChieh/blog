{"_path":"/articles/2024/nuxt2_to_nuxt3_blog_3_modules_content","_dir":"2024","_draft":false,"_partial":false,"_locale":"","title":"部落格Nuxt 2升級Nuxt 3（三）：Nuxt Content v1 → v2","description":"在初步修改非模組的設定值之後，接著就要開始著手模組的升級，這部份是連同改寫為 composition api 一起做的，畢竟不可能只升級特定模組的用法而不去動到其他程式碼，但為了讓文章閱讀容易，就還是分模組來紀錄。","img":"924/Ia2nWi.png","tags":["blog","nuxt","vue","nuxt2","nuxt3","nuxt content"],"category":"frontend","readingTime":{"text":"7 min read","minutes":6.025,"time":361500,"words":1205},"excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在"},{"type":"element","tag":"article-inner-link","props":{"slug":"nuxt2_to_nuxt3_blog_2_settings"},"children":[{"type":"text","value":"初步修改非模組的設定值"}]},{"type":"text","value":"之後，接著就要開始著手模組的升級，這部份是連同改寫為 composition api 一起做的，畢竟不可能只升級特定模組的用法而不去動到其他程式碼，但為了讓文章閱讀容易，就還是分模組來紀錄。"}]}]},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在"},{"type":"element","tag":"article-inner-link","props":{"slug":"nuxt2_to_nuxt3_blog_2_settings"},"children":[{"type":"text","value":"初步修改非模組的設定值"}]},{"type":"text","value":"之後，接著就要開始著手模組的升級，這部份是連同改寫為 composition api 一起做的，畢竟不可能只升級特定模組的用法而不去動到其他程式碼，但為了讓文章閱讀容易，就還是分模組來紀錄。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那麼，首先是部落格最重要的驅動基底：Nuxt Content。"}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"相關資料夾結構修改"},"children":[{"type":"text","value":"相關資料夾結構修改"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"第一步先來修改相關的資料夾結構。"}]},{"type":"element","tag":"h3","props":{"id":"content-資料夾"},"children":[{"type":"text","value":"content 資料夾"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"原本"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"content"}]},{"type":"text","value":"資料夾中下面的子資料夾結構是："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"articles/年份/文章們.md"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"draft/草稿們.md"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這部份的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"draft"}]},{"type":"text","value":"原本是透過查詢時直接排除，不過 Nuxt Content v2 可以透過前面加上一個"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"來讓整個資料夾及其下的文章「隱身」，參考"},{"type":"element","tag":"a","props":{"href":"https://content.nuxt.com/usage/content-directory","rel":["nofollow"]},"children":[{"type":"text","value":"官方文件"}]},{"type":"text","value":"修改如下："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".draft/草稿們.md"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"articles"}]},{"type":"text","value":"的部份就不用動了。"}]},{"type":"element","tag":"h3","props":{"id":"componentsglobal-componentscontent"},"children":[{"type":"text","value":"components/global → components/content"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"若要在文章中直接使用元件，原本是放在"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"components/global"}]},{"type":"text","value":"，Nuxt Content v2 中要改放在"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"components/content"}]},{"type":"text","value":"裡面。"}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"nuxt-content-git"},"children":[{"type":"text","value":"nuxt-content-git"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這個模組沒什麼需要修改的，直接"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"npm install nuxt-content-git"}]},{"type":"text","value":"然後在設定值中的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"modules"}]},{"type":"text","value":"啟用就可以了，使用原因可以看之前的文章："},{"type":"element","tag":"article-inner-link","props":{"slug":"nuxt2_content_git"},"children":[]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"為文章新增-reading-time"},"children":[{"type":"text","value":"為文章新增 reading-time"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Nuxt Content v1 時我使用"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"hooks"}]},{"type":"text","value":"中的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"content:file:beforeInsert"}]},{"type":"text","value":"來動態計算文章的閱讀時間，不過新版可以直接透過新增 "},{"type":"element","tag":"a","props":{"href":"https://github.com/remarkjs/remark/blob/main/doc/plugins.md","rel":["nofollow"]},"children":[{"type":"text","value":"remarkPlugins"}]},{"type":"text","value":" 來完成，首先先安裝 reading-time 的 plugin："}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"npm install -D remark-reading-time\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -D"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" remark-reading-time\n"}]}]}]}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes github-dark","code":"export default defineNuxtConfig({\n  content: {\n    markdown: {\n      // 接著新增設定值\n      remarkPlugins: ['remark-reading-time'],\n    },\n  },\n})\n","filename":"nuxt.config.ts","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" defineNuxtConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  content: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    markdown: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"      // 接著新增設定值\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      remarkPlugins: ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'remark-reading-time'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"這邊回壓到文章物件身上的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"readingTime"}]},{"type":"text","value":"會是物件，可以看自己需要取出對應的欄位來使用："}]},{"type":"element","tag":"pre","props":{"className":"language-json shiki shiki-themes github-dark","code":"{\n  \"text\": \"1 min read\",\n  \"minutes\": 1,\n  \"time\": 60000,\n  \"words\": 200\n}\n","language":"json","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"  \"text\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"1 min read\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"  \"minutes\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"  \"time\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"60000"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"  \"words\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"200\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"自定義元件"},"children":[{"type":"text","value":"自定義元件"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt Content v1 中我透過"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"content.markdown.highlighter"}]},{"type":"text","value":"來將 markdown 解析出來的 code 區塊"},{"type":"element","tag":"article-inner-link","props":{"slug":"nuxt2_content_code_block_copy_paste"},"children":[{"type":"text","value":"包上自己客製的元件來達成複製貼上程式碼功能"}]},{"type":"text","value":"，在 Nuxt Content v2 中可透過直接覆蓋設定值完成："}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes github-dark","code":"export default defineNuxtConfig({\n  content: {\n    markdown: {\n      tags: {\n        pre: 'ArticleCode',\n      },\n    },\n  },\n})\n","filename":"nuxt.config.ts","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" defineNuxtConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  content: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    markdown: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      tags: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        pre: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'ArticleCode'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"方便好多 XD。"}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"自行補上-slug"},"children":[{"type":"text","value":"自行補上 slug"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Nuxt Content v1 中，文章本身的檔名會變成"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"slug"}]},{"type":"text","value":"屬性，但在 v2 中則是使用"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_id"}]},{"type":"text","value":"而且會是串上文章所屬路徑的，例如這樣："}]},{"type":"element","tag":"pre","props":{"className":"language-json shiki shiki-themes github-dark","code":"{\n  \"_id\": \"content:articles:2024:nuxt2_to_nuxt3_blog_3_modules_content.md\"\n}\n","language":"json","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"  \"_id\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"content:articles:2024:nuxt2_to_nuxt3_blog_3_modules_content.md\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"由於我原本使用滿多"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"slug"}]},{"type":"text","value":"來做事，若要修改為使用"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_id"}]},{"type":"text","value":"變動會太大，所以這邊使用 "},{"type":"element","tag":"a","props":{"href":"https://content.nuxt.com/recipes/hooks","rel":["nofollow"]},"children":[{"type":"text","value":"Hooks"}]},{"type":"text","value":" 來自己補上"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"slug"}]},{"type":"text","value":"的欄位，根據官方文件需要新增一個檔案"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"server/plugins/content.js"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes github-dark","code":"export default defineNitroPlugin((nitroApp) => {\n  nitroApp.hooks.hook('content:file:afterParse', (file) => {\n    const slug = file._path.split('/').pop()\n    file.slug = slug\n  })\n})\n","filename":"server/plugins/content.js","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" defineNitroPlugin"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFAB70"},"children":[{"type":"text","value":"nitroApp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  nitroApp.hooks."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"hook"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'content:file:afterParse'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFAB70"},"children":[{"type":"text","value":"file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" slug"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" file._path."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"split"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'/'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"pop"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    file.slug "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" slug\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"未穩定的搜尋功能"},"children":[{"type":"text","value":"未穩定的搜尋功能"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt Content v2 有內建滿強大的全文模糊搜尋， v3 的搜尋功能雖然目前仍是「實驗（experimental）」階段，但試做之後沒啥問題，這邊紀錄一下設定跟使用方式。"}]},{"type":"element","tag":"h3","props":{"id":"啟用搜尋功能"},"children":[{"type":"text","value":"啟用搜尋功能"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那麼首先是啟用搜尋功能，修改"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config.ts"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes github-dark","code":"export default defineNuxtConfig({\n  content: {\n    experimental: {\n      // 官方文件是這樣寫，但這樣會無法通過ts檢查。\n      // search: true,\n      search: {\n        indexed: true,\n      },\n    },\n  },\n})\n","filename":"nuxt.config.ts","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" defineNuxtConfig"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  content: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    experimental: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"      // 官方文件是這樣寫，但這樣會無法通過ts檢查。\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"      // search: true,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      search: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        indexed: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"})\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"搜尋文章寫法"},"children":[{"type":"text","value":"搜尋文章寫法"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"搜尋也很容易，以下為自己簡單寫的範例："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes github-dark","code":"<template>\n  <div>\n    <input v-model=\"keyword\" type=\"text\" />\n    <button type=\"button\" @click=\"refresh\">搜尋</button>\n\n    <hr />\n    {{ results }}\n  </div>\n</template>\n\n<script setup>\nconst keyword = ref('')\n\nconst { data: results, refresh } = await useAsyncData(\n  `search:${keyword.value}`,\n  () => searchContent(keyword),\n  {\n    server: false,\n    immediate: false,\n    default: () => [],\n  }\n)\n</script>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"input"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" v-model"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"keyword\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"text\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" />\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"button"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"button\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" @click"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"refresh\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">搜尋</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"button"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"hr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" />\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    {{ results }}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  </"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"div"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"template"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" keyword"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" ref"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"''"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFAB70"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"results"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"refresh"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" useAsyncData"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"  `search:${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"keyword"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"}`"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" searchContent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(keyword),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    server: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    immediate: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"    default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" [],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"會回傳像下面這樣結果的陣列，可以根據需要使用欄位。"}]},{"type":"element","tag":"pre","props":{"className":"language-json shiki shiki-themes github-dark","code":"[\n  {\n    \"id\": \"/articles/2023/buy_me_a_tea#關於隨機手札\",\n    \"score\": 2.2401858303726176,\n    \"terms\": [\"fedora\"],\n    \"queryTerms\": [\"fedore\"],\n    \"match\": { \"fedora\": [\"content\"] },\n    \"title\": \"關於隨機手札\",\n    \"content\": \"……含有關鍵字的文章內容\",\n    \"titles\": []\n  }\n]\n","language":"json","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"id\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"/articles/2023/buy_me_a_tea#關於隨機手札\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"score\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"2.2401858303726176"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"terms\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"fedora\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"queryTerms\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"fedore\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"match\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"\"fedora\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"content\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"] },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"title\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"關於隨機手札\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"content\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"……含有關鍵字的文章內容\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"    \"titles\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": []\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"]\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"querycontent-與-useasyncdata-的眉角"},"children":[{"type":"text","value":"queryContent 與 useAsyncData 的眉角"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在將原本用到"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$content"}]},{"type":"text","value":"查詢文章的部份改寫成"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"queryContent"}]},{"type":"text","value":"時踩了一個坑，一度讓我懷疑自己是不是沒搞清楚"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"async"}]},{"type":"text","value":"以及"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"的用法，後來上網查資料才發現原來是一個"},{"type":"element","tag":"a","props":{"href":"https://github.com/nuxt/content/issues/1368","rel":["nofollow"]},"children":[{"type":"text","value":"「特別行為」"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"簡單來說，就是你不能在"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":"的回呼函式中"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"一個以上的非同步函式，所以像我原本在文章頁中同時查詢文章本身以及其相關文章的作法是不可行的，會報錯，例如像這樣："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes github-dark","code":"<script setup>\nawait useAsyncData(slug, async () => {\n  await queryContent()\n  await queryContent()\n})\n</script>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" useAsyncData"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(slug, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"  await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" queryContent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"  await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" queryContent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"所以，更好的作法就是"},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"每個"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"useAsyncData"}]},{"type":"text","value":"只包一個"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"queryContent"}]}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes github-dark","code":"<script setup>\nconst a = await useAsyncData(slug, () => queryContent())\nconst b = await useAsyncData(slug, () => queryContent())\n</script>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" a"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" useAsyncData"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(slug, () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" queryContent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" useAsyncData"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(slug, () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" queryContent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那如果要從陣列一次平行調用很多的"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"queryContent"}]},{"type":"text","value":"呢？例如我從自定義的數個文章分類要一次平行查詢，那就要用"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Promise.all"}]},{"type":"text","value":"把他們包裝起來，然後"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"這個"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Promise.all"}]},{"type":"text","value":"（這真的滿反直覺的……而且文件都沒寫 QQ），像這樣："}]},{"type":"element","tag":"pre","props":{"className":"language-vue shiki shiki-themes github-dark","code":"<script setup>\nconst { data: categories } = await useAsyncData('categories', async () => {\n  await Promise.all(\n    Object.keys(categories).map((category) => queryContent().find())\n  )\n\n  return categories\n})\n</script>\n","language":"vue","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" setup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFAB70"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"categories"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" useAsyncData"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'categories'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"  await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" Promise"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"all"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    Object."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"keys"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(categories)."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"map"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFAB70"},"children":[{"type":"text","value":"category"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" queryContent"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"find"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  )\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" categories\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"})\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"script"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"後記"},"children":[{"type":"text","value":"後記"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nuxt Content 的部份大概就是這樣，除了踩了一個坑以外大致都還行，後面在升級其他模組時也有踩到一些坑，雖然覺得耗費心神，但踩坑也代表學了點新東西（吧）。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"相關資料夾結構修改","depth":2,"text":"相關資料夾結構修改","children":[{"id":"content-資料夾","depth":3,"text":"content 資料夾"},{"id":"componentsglobal-componentscontent","depth":3,"text":"components/global → components/content"}]},{"id":"nuxt-content-git","depth":2,"text":"nuxt-content-git"},{"id":"為文章新增-reading-time","depth":2,"text":"為文章新增 reading-time"},{"id":"自定義元件","depth":2,"text":"自定義元件"},{"id":"自行補上-slug","depth":2,"text":"自行補上 slug"},{"id":"未穩定的搜尋功能","depth":2,"text":"未穩定的搜尋功能","children":[{"id":"啟用搜尋功能","depth":3,"text":"啟用搜尋功能"},{"id":"搜尋文章寫法","depth":3,"text":"搜尋文章寫法"}]},{"id":"querycontent-與-useasyncdata-的眉角","depth":2,"text":"queryContent 與 useAsyncData 的眉角"},{"id":"後記","depth":2,"text":"後記"}]}},"_type":"markdown","_id":"content:articles:2024:nuxt2_to_nuxt3_blog_3_modules_content.md","_source":"content","_file":"articles/2024/nuxt2_to_nuxt3_blog_3_modules_content.md","_stem":"articles/2024/nuxt2_to_nuxt3_blog_3_modules_content","_extension":"md","createdAt":"2024-01-24T07:26:04.000Z","updatedAt":"2024-01-24T07:26:04.000Z","slug":"nuxt2_to_nuxt3_blog_3_modules_content","plainTexts":["在","初步修改非模組的設定值","之後，接著就要開始著手模組的升級，這部份是連同改寫為 composition api 一起做的，畢竟不可能只升級特定模組的用法而不去動到其他程式碼，但為了讓文章閱讀容易，就還是分模組來紀錄。","那麼，首先是部落格最重要的驅動基底：Nuxt Content。","相關資料夾結構修改","第一步先來修改相關的資料夾結構。","content 資料夾","原本","content","資料夾中下面的子資料夾結構是：","articles/年份/文章們.md","draft/草稿們.md","這部份的","draft","原本是透過查詢時直接排除，不過 Nuxt Content v2 可以透過前面加上一個",".","來讓整個資料夾及其下的文章「隱身」，參考","官方文件","修改如下：",".draft/草稿們.md","articles","的部份就不用動了。","components/global → components/content","若要在文章中直接使用元件，原本是放在","components/global","，Nuxt Content v2 中要改放在","components/content","裡面。","nuxt-content-git","這個模組沒什麼需要修改的，直接","npm install nuxt-content-git","然後在設定值中的","modules","啟用就可以了，使用原因可以看之前的文章：","為文章新增 reading-time","在 Nuxt Content v1 時我使用","hooks","中的","content:file:beforeInsert","來動態計算文章的閱讀時間，不過新版可以直接透過新增","remarkPlugins","來完成，首先先安裝 reading-time 的 plugin：","npm","install","-D","remark-reading-time","export","default","defineNuxtConfig","({","content: {","markdown: {","// 接著新增設定值","remarkPlugins: [","'remark-reading-time'","],","},","},","})","這邊回壓到文章物件身上的","readingTime","會是物件，可以看自己需要取出對應的欄位來使用：","{","\"text\"",":","\"1 min read\"",",","\"minutes\"",":","1",",","\"time\"",":","60000",",","\"words\"",":","200","}","自定義元件","Nuxt Content v1 中我透過","content.markdown.highlighter","來將 markdown 解析出來的 code 區塊","包上自己客製的元件來達成複製貼上程式碼功能","，在 Nuxt Content v2 中可透過直接覆蓋設定值完成：","export","default","defineNuxtConfig","({","content: {","markdown: {","tags: {","pre:","'ArticleCode'",",","},","},","},","})","方便好多 XD。","自行補上 slug","在 Nuxt Content v1 中，文章本身的檔名會變成","slug","屬性，但在 v2 中則是使用","_id","而且會是串上文章所屬路徑的，例如這樣：","{","\"_id\"",":","\"content:articles:2024:nuxt2_to_nuxt3_blog_3_modules_content.md\"","}","由於我原本使用滿多","slug","來做事，若要修改為使用","_id","變動會太大，所以這邊使用","Hooks","來自己補上","slug","的欄位，根據官方文件需要新增一個檔案","server/plugins/content.js","：","export","default","defineNitroPlugin","((","nitroApp",")","=>","{","nitroApp.hooks.","hook","(","'content:file:afterParse'",", (","file",")","=>","{","const","slug","=","file._path.","split","(","'/'",").","pop","()","file.slug","=","slug","})","})","未穩定的搜尋功能","Nuxt Content v2 有內建滿強大的全文模糊搜尋， v3 的搜尋功能雖然目前仍是「實驗（experimental）」階段，但試做之後沒啥問題，這邊紀錄一下設定跟使用方式。","啟用搜尋功能","那麼首先是啟用搜尋功能，修改","nuxt.config.ts","：","export","default","defineNuxtConfig","({","content: {","experimental: {","// 官方文件是這樣寫，但這樣會無法通過ts檢查。","// search: true,","search: {","indexed:","true",",","},","},","},","})","搜尋文章寫法","搜尋也很容易，以下為自己簡單寫的範例：","<","template",">","<","div",">","<","input","v-model","=","\"keyword\"","type","=","\"text\"","/>","<","button","type","=","\"button\"","@click","=","\"refresh\"",">搜尋</","button",">","","<","hr","/>","{{ results }}","</","div",">","</","template",">","","<","script","setup",">","const","keyword","=","ref","(","''",")","","const","{","data",":","results",",","refresh","}","=","await","useAsyncData","(","`search:${","keyword",".","value","}`",",","()","=>","searchContent","(keyword),","{","server:","false",",","immediate:","false",",","default",": ()","=>","[],","}",")","</","script",">","會回傳像下面這樣結果的陣列，可以根據需要使用欄位。","[","{","\"id\"",":","\"/articles/2023/buy_me_a_tea#關於隨機手札\"",",","\"score\"",":","2.2401858303726176",",","\"terms\"",": [","\"fedora\"","],","\"queryTerms\"",": [","\"fedore\"","],","\"match\"",": {","\"fedora\"",": [","\"content\"","] },","\"title\"",":","\"關於隨機手札\"",",","\"content\"",":","\"……含有關鍵字的文章內容\"",",","\"titles\"",": []","}","]","queryContent 與 useAsyncData 的眉角","在將原本用到","$content","查詢文章的部份改寫成","queryContent","時踩了一個坑，一度讓我懷疑自己是不是沒搞清楚","async","以及","await","的用法，後來上網查資料才發現原來是一個","「特別行為」","。","簡單來說，就是你不能在","useAsyncData","的回呼函式中","await","一個以上的非同步函式，所以像我原本在文章頁中同時查詢文章本身以及其相關文章的作法是不可行的，會報錯，例如像這樣：","<","script","setup",">","await","useAsyncData","(slug,","async","()","=>","{","await","queryContent","()","await","queryContent","()","})","</","script",">","所以，更好的作法就是","每個","useAsyncData","只包一個","queryContent","：","<","script","setup",">","const","a","=","await","useAsyncData","(slug, ()","=>","queryContent","())","const","b","=","await","useAsyncData","(slug, ()","=>","queryContent","())","</","script",">","那如果要從陣列一次平行調用很多的","queryContent","呢？例如我從自定義的數個文章分類要一次平行查詢，那就要用","Promise.all","把他們包裝起來，然後","await","這個","Promise.all","（這真的滿反直覺的……而且文件都沒寫 QQ），像這樣：","<","script","setup",">","const","{","data",":","categories","}","=","await","useAsyncData","(","'categories'",",","async","()","=>","{","await","Promise",".","all","(","Object.","keys","(categories).","map","((","category",")","=>","queryContent","().","find","())",")","","return","categories","})","</","script",">","後記","Nuxt Content 的部份大概就是這樣，除了踩了一個坑以外大致都還行，後面在升級其他模組時也有踩到一些坑，雖然覺得耗費心神，但踩坑也代表學了點新東西（吧）。","html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"]}