{"tags":["nuxt","vue","sitemap"],"category":"frontend","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sitemap 雖然對網站來說非必要，但為了 SEO 考量通常都還是會建立。而在 Nuxt 2 中可以透過"},{"type":"element","tag":"a","props":{"href":"https://sitemap.nuxtjs.org/","rel":["nofollow"]},"children":[{"type":"text","value":"@nuxt/sitemap"}]},{"type":"text","value":"模組來簡單建立 sitemap。但若遇到動態頁面，這個模組無法自動新增，官方文件要求使用者必須自行新增，而官方建議的作法以及網路上查到的方式好像都滿麻煩的，所以自己搞了一個小撇步出來，覺得頗方便，所以就紀錄下來。"}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"解決過程"},"children":[{"type":"text","value":"解決過程"}]},{"type":"element","tag":"h3","props":{"id":"官方建議"},"children":[{"type":"text","value":"官方建議？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先，根據"},{"type":"element","tag":"a","props":{"href":"https://sitemap.nuxtjs.org/usage/sitemap#setup-a-sitemap","rel":["nofollow"]},"children":[{"type":"text","value":"官方文件"}]},{"type":"text","value":"所說，模組本身只會預設建立固定頁面（也就是在路徑 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"pages"}]},{"type":"text","value":" 中建立的非動態頁面——也就是不使用 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_param.vue"}]},{"type":"text","value":" 形式建立的頁面）的 sitemap："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All static routes (eg. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/pages/about.vue"}]},{"type":"text","value":") are automatically add to the sitemap, but you can exclude each of them with the "},{"type":"element","tag":"a","props":{"href":"https://sitemap.nuxtjs.org/usage/sitemap-options#exclude-optional---string-array","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"exclude"}]}]},{"type":"text","value":" property."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For dynamic routes (eg. "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/pages/\\_id.vue"}]},{"type":"text","value":"), you have to declare them with the "},{"type":"element","tag":"a","props":{"href":"https://sitemap.nuxtjs.org/usage/sitemap-options#routes-optional---array--function","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"routes"}]}]},{"type":"text","value":" property. This option can be an array or a function. In addition, the routes defined in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"generate.routes"}]},{"type":"text","value":" will be automatically used for the sitemap."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"然而官方建議的作法滿麻煩的："}]},{"type":"element","tag":"pre","props":{"className":"language-javascript shiki shiki-themes github-dark","code":"export default {\n  sitemap: {\n    hostname: 'https://example.com',\n    gzip: true,\n    exclude: ['/secret', '/admin/**'],\n    routes: [\n      '/page/1',\n      '/page/2',\n      {\n        url: '/page/3',\n        changefreq: 'daily',\n        priority: 1,\n        lastmod: '2017-06-30T13:30:00.000Z',\n      },\n    ],\n  },\n}\n","filename":"nuxt.config.js","language":"javascript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  sitemap: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    hostname: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'https://example.com'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    gzip: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    exclude: ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'/secret'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'/admin/**'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    routes: [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"      '/page/1'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"      '/page/2'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        url: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'/page/3'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        changefreq: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'daily'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        priority: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        lastmod: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'2017-06-30T13:30:00.000Z'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    ],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"也就是要自己去抓取動態頁面而且把可能會用到的動態參數自己填上去，然後做成陣列的形式回傳，若動態頁面不多或許還算容易，但若動態頁面不少或是參數很複雜，那可能就會很麻煩。上網查了一下，作法好像都差不多，所以就自己思考有沒有比較好的作法。"}]},{"type":"element","tag":"h3","props":{"id":"使用-nuxt-的內建-crawler"},"children":[{"type":"text","value":"使用 Nuxt 的內建 crawler"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"後來想想，Nuxt 2 不是有內建 "},{"type":"element","tag":"a","props":{"href":"https://v2.nuxt.com/docs/get-started/commands#static-deployment-pre-rendered","rel":["nofollow"]},"children":[{"type":"text","value":"crawler"}]},{"type":"text","value":" 來產生動態參數的靜態頁面嗎？如果在 Nuxt 2 的 "},{"type":"element","tag":"a","props":{"href":"https://v2.nuxt.com/docs/internals-glossary/internals-generator#hooks","rel":["nofollow"]},"children":[{"type":"text","value":"Generate Hooks"}]},{"type":"text","value":" 中把抓到的 routes 放到一個全域變數，然後在 sitemap 模組在產生檔案時傳進去，就不用自己傳了吧？"}]},{"type":"element","tag":"h3","props":{"id":"實作"},"children":[{"type":"text","value":"實作"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"那麼就來實作吧，大致的概念就跟上面說的一樣，"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"nuxt.config.js"}]},{"type":"text","value":"設定檔前面宣告一個陣列，在"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"generate:hooks"}]},{"type":"text","value":"的時候存放到陣列中，並傳給 sitemap 模組："}]},{"type":"element","tag":"pre","props":{"className":"language-javascript shiki shiki-themes github-dark","code":"// 存放從generate hooks偷出來的routes\nconst routes = []\n\nexport default {\n  // 從generate hooks偷routes出來給sitemap使用\n  hooks: {\n    generate: {\n      route(data) {\n        const { route } = data\n        routes.push(data)\n      },\n    },\n  },\n  sitemap: {\n    hostname: 'https://example.com',\n    gzip: true,\n    // 直接使用routes\n    routes,\n  },\n}\n","filename":"nuxt.config.js","language":"javascript","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// 存放從generate hooks偷出來的routes\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" routes"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" []\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"  // 從generate hooks偷routes出來給sitemap使用\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  hooks: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    generate: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"      route"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#FFAB70"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"        const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"route"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" data\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        routes."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(data)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  sitemap: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    hostname: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'https://example.com'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    gzip: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"    // 直接使用routes\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    routes,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"檢驗-sitemap"},"children":[{"type":"text","value":"檢驗 sitemap"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"設定好之後執行"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"npm run generate"}]},{"type":"text","value":"再檢查"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"dist/sitemap.xml"}]},{"type":"text","value":"，以這個部落格為例子，就有看到出現下面的動態頁面網址，代表成功了："}]},{"type":"element","tag":"pre","props":{"className":"language-xml shiki shiki-themes github-dark","code":"<url>\n  <loc>https://huangchingchieh.github.io/blog/pages/1</loc>\n</url>\n","language":"xml","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  <"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"loc"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">https://huangchingchieh.github.io/blog/pages/1</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"loc"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#85E89D"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":">\n"}]}]}]}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h2","props":{"id":"後記"},"children":[{"type":"text","value":"後記"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"其實有點疑問為何這個模組沒有整合 crawler，找了一下官方文件好像也沒說明，但總之自己亂搞弄出來一個解決方式了（？）。"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"解決過程","depth":2,"text":"解決過程","children":[{"id":"官方建議","depth":3,"text":"官方建議？"},{"id":"使用-nuxt-的內建-crawler","depth":3,"text":"使用 Nuxt 的內建 crawler"},{"id":"實作","depth":3,"text":"實作"},{"id":"檢驗-sitemap","depth":3,"text":"檢驗 sitemap"}]},{"id":"後記","depth":2,"text":"後記"}]}}}